{"ast":null,"code":"import React,{useEffect,useRef}from\"react\";import{Rect,Transformer}from\"react-konva\";import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const BBox=_ref=>{let{rectProps,onChange,isSelected,onClick,scale,strokeWidth,mode=\"Edit\"}=_ref;// Ref 타입을 Konva.Rect와 Konva.Transformer로 명확히 지정\nconst shapeRef=useRef(null);const trRef=useRef(null);useEffect(()=>{if(isSelected&&trRef.current&&shapeRef.current){var _trRef$current$getLay;// Transformer 설정\ntrRef.current.nodes([shapeRef.current]);// 변형 활성화 설정\ntrRef.current.visible(true);// 더 정밀한 변형 제어를 위한 설정\ntrRef.current.enabledAnchors(['top-left','top-center','top-right','middle-left','middle-right','bottom-left','bottom-center','bottom-right']);// 비율 유지 해제 (자유로운 리사이징)\ntrRef.current.keepRatio(false);// 회전 비활성화 (필요시 활성화 가능)\ntrRef.current.rotateEnabled(false);// 패딩 조정으로 앵커 포인트 접근성 향상\ntrRef.current.padding(2);// 앵커 크기 키우기\ntrRef.current.anchorSize(10);// 앵커 스트로크 두께 키우기\ntrRef.current.anchorStrokeWidth(2);// 앵커 색상 설정\ntrRef.current.anchorFill('#FFFFFF');trRef.current.anchorStroke(rectProps.stroke||'#0000FF');// 앵커 코너 라운딩 추가\ntrRef.current.anchorCornerRadius(4);// 레이어 업데이트 (중요: 변경사항을 화면에 반영)\n(_trRef$current$getLay=trRef.current.getLayer())===null||_trRef$current$getLay===void 0?void 0:_trRef$current$getLay.batchDraw();}},[isSelected,rectProps.stroke]);// Edit 모드일 때만 드래그 가능하도록 설정\nconst isDraggable=mode===\"Edit\";return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Rect,{ref:shapeRef,x:rectProps.x*scale,y:rectProps.y*scale,width:rectProps.width*scale,height:rectProps.height*scale,stroke:rectProps.stroke,strokeWidth:strokeWidth,dash:[5,5]// 점선 스타일 추가\n,fill:isSelected?rectProps.stroke+\"20\":\"transparent\"// 선택 시 약간의 배경 투명도 추가\n,draggable:isDraggable// 드래그 가능 여부 설정\n,onClick:onClick// 클릭 이벤트 추가\n,onTap:onClick// 모바일 터치 이벤트 추가\n// 드래그 종료 시 위치 업데이트\n,onDragEnd:e=>{if(!shapeRef.current)return;const node=shapeRef.current;onChange({...rectProps,x:node.x()/scale,y:node.y()/scale});}// 스케일 변환 후 위치 및 크기 업데이트\n,onTransformEnd:e=>{if(!shapeRef.current)return;const node=shapeRef.current;const scaleX=node.scaleX();const scaleY=node.scaleY();// 스케일 초기화\nnode.scaleX(1);node.scaleY(1);// 변경된 위치 및 크기 적용\nonChange({...rectProps,x:node.x()/scale,y:node.y()/scale,width:Math.max(5,node.width()*scaleX)/scale,// 최소 크기 제한 추가\nheight:Math.max(5,node.height()*scaleY)/scale// 최소 크기 제한 추가\n});}}),isSelected&&mode===\"Edit\"&&/*#__PURE__*/_jsx(Transformer,{ref:trRef,anchorStroke:rectProps.stroke||'#0000FF',anchorFill:\"#FFFFFF\",anchorSize:10,anchorCornerRadius:4,borderStroke:rectProps.stroke||'#0000FF',borderDash:[3,3],borderStrokeWidth:1,boundBoxFunc:(oldBox,newBox)=>{// 최소 크기 제한 (5x5 픽셀)\nif(newBox.width<5||newBox.height<5){return oldBox;}return newBox;}})]});};export default BBox;","map":{"version":3,"names":["React","useEffect","useRef","Rect","Transformer","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","BBox","_ref","rectProps","onChange","isSelected","onClick","scale","strokeWidth","mode","shapeRef","trRef","current","_trRef$current$getLay","nodes","visible","enabledAnchors","keepRatio","rotateEnabled","padding","anchorSize","anchorStrokeWidth","anchorFill","anchorStroke","stroke","anchorCornerRadius","getLayer","batchDraw","isDraggable","children","ref","x","y","width","height","dash","fill","draggable","onTap","onDragEnd","e","node","onTransformEnd","scaleX","scaleY","Math","max","borderStroke","borderDash","borderStrokeWidth","boundBoxFunc","oldBox","newBox"],"sources":["/Users/nongshim/Desktop/Python/project/streamlit_image_annotation_backup/Detection/frontend/src/BBox.tsx"],"sourcesContent":["import React, { useEffect, useRef } from \"react\";\nimport { Rect, Transformer } from \"react-konva\";\nimport Konva from \"konva\";\n\nexport interface RectProps {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  id: string;\n  stroke: string;\n  label: string;\n}\n\nexport interface BBoxProps {\n  rectProps: RectProps;\n  onChange: (newRect: RectProps) => void;\n  isSelected: boolean;\n  onClick: () => void;\n  scale: number;\n  strokeWidth: number;\n  mode?: string;\n}\n\nconst BBox: React.FC<BBoxProps> = ({\n  rectProps,\n  onChange,\n  isSelected,\n  onClick,\n  scale,\n  strokeWidth,\n  mode = \"Edit\",\n}) => {\n  // Ref 타입을 Konva.Rect와 Konva.Transformer로 명확히 지정\n  const shapeRef = useRef<Konva.Rect | null>(null);\n  const trRef = useRef<Konva.Transformer | null>(null);\n\n  useEffect(() => {\n    if (isSelected && trRef.current && shapeRef.current) {\n      // Transformer 설정\n      trRef.current.nodes([shapeRef.current]);\n      \n      // 변형 활성화 설정\n      trRef.current.visible(true);\n      \n      // 더 정밀한 변형 제어를 위한 설정\n      trRef.current.enabledAnchors([\n        'top-left', 'top-center', 'top-right', \n        'middle-left', 'middle-right', \n        'bottom-left', 'bottom-center', 'bottom-right'\n      ]);\n\n      // 비율 유지 해제 (자유로운 리사이징)\n      trRef.current.keepRatio(false);\n\n      // 회전 비활성화 (필요시 활성화 가능)\n      trRef.current.rotateEnabled(false);\n\n      // 패딩 조정으로 앵커 포인트 접근성 향상\n      trRef.current.padding(2);\n\n      // 앵커 크기 키우기\n      trRef.current.anchorSize(10);\n\n      // 앵커 스트로크 두께 키우기\n      trRef.current.anchorStrokeWidth(2);\n\n      // 앵커 색상 설정\n      trRef.current.anchorFill('#FFFFFF');\n      trRef.current.anchorStroke(rectProps.stroke || '#0000FF');\n      \n      // 앵커 코너 라운딩 추가\n      trRef.current.anchorCornerRadius(4);\n\n      // 레이어 업데이트 (중요: 변경사항을 화면에 반영)\n      trRef.current.getLayer()?.batchDraw();\n    }\n  }, [isSelected, rectProps.stroke]);\n\n  // Edit 모드일 때만 드래그 가능하도록 설정\n  const isDraggable = mode === \"Edit\";\n\n  return (\n    <>\n      <Rect\n        ref={shapeRef}\n        x={rectProps.x * scale}\n        y={rectProps.y * scale}\n        width={rectProps.width * scale}\n        height={rectProps.height * scale}\n        stroke={rectProps.stroke}\n        strokeWidth={strokeWidth}\n        dash={[5, 5]} // 점선 스타일 추가\n        fill={isSelected ? rectProps.stroke + \"20\" : \"transparent\"} // 선택 시 약간의 배경 투명도 추가\n        draggable={isDraggable} // 드래그 가능 여부 설정\n        onClick={onClick} // 클릭 이벤트 추가\n        onTap={onClick} // 모바일 터치 이벤트 추가\n        // 드래그 종료 시 위치 업데이트\n        onDragEnd={(e) => { \n          if (!shapeRef.current) return;\n          const node = shapeRef.current;\n          onChange({ \n            ...rectProps,\n            x: node.x() / scale,\n            y: node.y() / scale,\n          });\n        }}\n        // 스케일 변환 후 위치 및 크기 업데이트\n        onTransformEnd={(e) => {\n          if (!shapeRef.current) return;\n          const node = shapeRef.current;\n          const scaleX = node.scaleX();\n          const scaleY = node.scaleY();\n\n          // 스케일 초기화\n          node.scaleX(1);\n          node.scaleY(1);\n\n          // 변경된 위치 및 크기 적용\n          onChange({\n            ...rectProps,\n            x: node.x() / scale,\n            y: node.y() / scale,\n            width: Math.max(5, node.width() * scaleX) / scale, // 최소 크기 제한 추가\n            height: Math.max(5, node.height() * scaleY) / scale, // 최소 크기 제한 추가\n          });\n        }}\n      />\n      {isSelected && mode === \"Edit\" && (\n        <Transformer \n          ref={trRef}\n          anchorStroke={rectProps.stroke || '#0000FF'}\n          anchorFill=\"#FFFFFF\"\n          anchorSize={10}\n          anchorCornerRadius={4}\n          borderStroke={rectProps.stroke || '#0000FF'}\n          borderDash={[3, 3]}\n          borderStrokeWidth={1}\n          boundBoxFunc={(oldBox, newBox) => {\n            // 최소 크기 제한 (5x5 픽셀)\n            if (newBox.width < 5 || newBox.height < 5) {\n              return oldBox;\n            }\n            return newBox;\n          }}\n        />\n      )}\n    </>\n  );\n};\n\nexport default BBox;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}