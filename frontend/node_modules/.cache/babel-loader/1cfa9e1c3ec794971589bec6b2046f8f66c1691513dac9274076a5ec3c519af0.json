{"ast":null,"code":"import{Streamlit,withStreamlitConnection}from\"streamlit-component-lib\";import React,{useEffect,useState,useRef}from\"react\";import{ChakraProvider,Input,Box,HStack,VStack,Center,Button,Text,Flex}from'@chakra-ui/react';import{extendTheme}from'@chakra-ui/react';import useImage from'use-image';import BBoxCanvas from\"./BBoxCanvas\";import{useOcrManager}from\"./useOcrManager\";// OCR 훅\nimport debounce from'lodash/debounce';// 🔄 줌 최적화를 위한 debounce 추가\n// Chakra UI 테마 설정\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const theme=extendTheme({config:{initialColorMode:'light',useSystemColorMode:false}});// Python에서 전달된 파라미터 정의\n// BBox 타입 정의\n// Python에서 사용할 형식으로 포맷\nconst formatBBoxes=rects=>rects.map(rect=>({box_id:rect.id,bbox:[rect.x,rect.y,rect.width,rect.height],label:rect.label||\"\"}));// 컴포넌트 본체\nconst Detection=_ref=>{let{args}=_ref;const{image_url,image_size,bbox_info,color_map,line_width,use_space,ocr_suggestions}=args;const params=new URLSearchParams(window.location.search);const baseUrl=params.get('streamlitUrl');const[image]=useImage(baseUrl+image_url);const[rectangles,setRectangles]=useState(bbox_info.map((bb,i)=>({x:bb.bbox[0],y:bb.bbox[1],width:bb.bbox[2],height:bb.bbox[3],label:bb.label,stroke:\"#39FF14\",id:'bbox-'+i})));const[selectedId,setSelectedId]=useState(null);const[label,setLabel]=useState(\"\");const[mode,setMode]=useState('Draw');const[isLabelEditMode,setIsLabelEditMode]=useState(false);const[scale,setScale]=useState(1.0);const[saveNotification,setSaveNotification]=useState(false);const[showLabels,setShowLabels]=useState(false);const canvasWrapperRef=useRef(null);// 🔍 캔버스 영역 추적용 ref\nconst{requestOcrForBox,handleOcrResponse,resetOcrState,suggestedLabels,showSuggestions,isLoading:isLoadingLabels,setShowSuggestions}=useOcrManager({rectangles,scale,mode});useEffect(()=>{if(selectedId){const selectedRect=rectangles.find(rect=>rect.id===selectedId);if(selectedRect){setLabel(selectedRect.label);}}},[selectedId,rectangles]);const handleLabelInputChange=event=>{setLabel(event.target.value);};const commitLabelChange=()=>{if(selectedId!==null){setRectangles(prev=>prev.map(rect=>rect.id===selectedId?{...rect,label:label,stroke:\"#39FF14\"}:rect));}};// // OCR 요청을 위한 함수\n// useEffect(() => {\n//   if (args.ocr_suggestions && args.ocr_suggestions.length > 0) {\n//     handleOcrResponse(args.ocr_suggestions);\n//   }\n// }, [args.ocr_suggestions]);\nconst previousOcrRef=useRef(null);// ✅ 이전 OCR 결과 캐시\nuseEffect(()=>{if(args.ocr_suggestions&&args.ocr_suggestions.length>0&&JSON.stringify(args.ocr_suggestions)!==JSON.stringify(previousOcrRef.current)){previousOcrRef.current=args.ocr_suggestions;// ✅ 중복 방지용 캐시 업데이트\nhandleOcrResponse(args.ocr_suggestions);// ✅ OCR 결과 반영\nsendToStreamlit({request_ocr:false});// ✅ JS 측에서도 OCR 요청 종료 신호\n}},[args.ocr_suggestions]);// OCR 응답을 처리하는 함수\nuseEffect(()=>{const onDataFromPython=event=>{if(event.data.type==='streamlit:render'){try{const args=event.data.args;if(args!==null&&args!==void 0&&args.ocr_suggestions&&Array.isArray(args.ocr_suggestions)){handleOcrResponse(args.ocr_suggestions);}}catch(error){console.error(\"Error handling OCR suggestions from message:\",error);}}};window.addEventListener('message',onDataFromPython);return()=>window.removeEventListener('message',onDataFromPython);},[]);useEffect(()=>{if(args.request_ocr===false||args.request_ocr===undefined){resetOcrState();}},[args.request_ocr]);// 🔄 줌 최적화를 위한 debounce 설정\nconst debouncedUpdateFrameHeight=debounce(()=>{if(image_size[1]>0){Streamlit.setFrameHeight(image_size[1]*scaleRef.current+100);}},100);// ← 100ms 안에 1번만 실행\nuseEffect(()=>{const initializeScale=()=>{if(scale===1.0&&image_size[0]>0){const scale_ratio=window.innerWidth*0.8/image_size[0];setScale(Math.min(scale_ratio,1.0));}};initializeScale();debouncedUpdateFrameHeight();window.addEventListener('resize',debouncedUpdateFrameHeight);return()=>{window.removeEventListener('resize',debouncedUpdateFrameHeight);};},[image_size,scale]);const modeRef=useRef(mode);const selectedIdRef=useRef(selectedId);const useSpaceRef=useRef(use_space);const isLabelEditModeRef=useRef(isLabelEditMode);const rectanglesRef=useRef(rectangles);const scaleRef=useRef(scale);useEffect(()=>{modeRef.current=mode;},[mode]);useEffect(()=>{selectedIdRef.current=selectedId;},[selectedId]);useEffect(()=>{useSpaceRef.current=use_space;},[use_space]);useEffect(()=>{isLabelEditModeRef.current=isLabelEditMode;},[isLabelEditMode]);useEffect(()=>{rectanglesRef.current=rectangles;},[rectangles]);useEffect(()=>{scaleRef.current=scale;},[scale]);const buildPayload=function(){var _options$mode,_options$selectedBoxI,_options$save_request,_options$request_ocr;let options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};const currentMode=(_options$mode=options.mode)!==null&&_options$mode!==void 0?_options$mode:modeRef.current;const selectedBoxId=(_options$selectedBoxI=options.selectedBoxId)!==null&&_options$selectedBoxI!==void 0?_options$selectedBoxI:selectedIdRef.current;const currentRectangles=rectanglesRef.current;const currentScale=scaleRef.current;const selectedBox=currentRectangles.find(box=>box.id===selectedBoxId);const payload={mode:currentMode,bboxes:formatBBoxes(currentRectangles),scale:currentScale,save_requested:(_options$save_request=options.save_requested)!==null&&_options$save_request!==void 0?_options$save_request:false,request_ocr:(_options$request_ocr=options.request_ocr)!==null&&_options$request_ocr!==void 0?_options$request_ocr:false};if(selectedBox){payload.selected_box_id=selectedBox.id;payload.selected_box_coords=[selectedBox.x,selectedBox.y,selectedBox.width,selectedBox.height];}return payload;};const sendToStreamlit=function(){let options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};const payload=buildPayload(options);Streamlit.setComponentValue(payload);};useEffect(()=>{const handleKeyPress=event=>{const mode=modeRef.current;const selectedId=selectedIdRef.current;const use_space=useSpaceRef.current;const isLabelEditMode=isLabelEditModeRef.current;const rectangles=rectanglesRef.current;if(use_space&&event.code===\"Space\"){sendToStreamlit();}if(event.ctrlKey&&event.code===\"KeyE\"){event.preventDefault();setMode(\"Edit\");sendToStreamlit({mode:\"Edit\"});}if(event.ctrlKey&&event.code===\"KeyD\"){event.preventDefault();setMode(\"Draw\");sendToStreamlit({mode:\"Draw\"});}if(event.ctrlKey&&event.code===\"KeyL\"){event.preventDefault();if(selectedId){setIsLabelEditMode(true);setShowSuggestions(true);}}if(event.ctrlKey&&event.code===\"KeyM\"){event.preventDefault();if(selectedId){requestOcrForBox(selectedId);}}if(event.ctrlKey&&event.code===\"KeyR\"){event.preventDefault();setShowLabels(prev=>!prev);}if(event.ctrlKey&&event.code===\"KeyS\"){event.preventDefault();setSaveNotification(true);setTimeout(()=>{setSaveNotification(false);},3000);sendToStreamlit({save_requested:true});}if(event.code===\"Delete\"&&selectedId){event.preventDefault();setRectangles(prev=>prev.filter(rect=>rect.id!==selectedId));setSelectedId(null);setIsLabelEditMode(false);}if(event.code===\"Escape\"){event.preventDefault();if(isLabelEditMode||selectedId){setIsLabelEditMode(false);setSelectedId(null);}}};window.addEventListener(\"keydown\",handleKeyPress);return()=>{window.removeEventListener(\"keydown\",handleKeyPress);};},[]);useEffect(()=>{const debouncedSetScale=debounce(newScale=>{setScale(newScale);},50);const handleWheel=event=>{var _canvasWrapperRef$cur;if(event.ctrlKey&&(_canvasWrapperRef$cur=canvasWrapperRef.current)!==null&&_canvasWrapperRef$cur!==void 0&&_canvasWrapperRef$cur.contains(event.target)){event.preventDefault();let newScale=scaleRef.current+(event.deltaY<0?0.1:-0.1);newScale=Math.min(Math.max(newScale,0.5),3.0);debouncedSetScale(newScale);}};window.addEventListener('wheel',handleWheel,{passive:false});return()=>{window.removeEventListener('wheel',handleWheel);};},[]);const formatScale=scale=>`${Math.round(scale*100)}%`;const handleModeChange=newMode=>{setMode(newMode);sendToStreamlit({mode:newMode});};const handleSuggestionSelect=suggestedLabel=>{setLabel(suggestedLabel);if(selectedId!==null){setRectangles(prev=>prev.map(rect=>rect.id===selectedId?{...rect,label:suggestedLabel,stroke:\"#39FF14\"}:rect));}setShowSuggestions(false);};return/*#__PURE__*/_jsx(ChakraProvider,{theme:theme,children:/*#__PURE__*/_jsxs(VStack,{spacing:4,align:\"stretch\",children:[saveNotification&&/*#__PURE__*/_jsx(Box,{p:3,bg:\"green.100\",color:\"green.800\",borderRadius:\"md\",position:\"fixed\",top:\"20px\",left:\"50%\",transform:\"translateX(-50%)\",zIndex:100,boxShadow:\"md\",children:/*#__PURE__*/_jsx(Text,{fontWeight:\"bold\",children:\"\\uD83D\\uDCBE \\uC5B4\\uB178\\uD14C\\uC774\\uC158 \\uC800\\uC7A5 \\uC694\\uCCAD\\uC774 \\uC804\\uC1A1\\uB418\\uC5C8\\uC2B5\\uB2C8\\uB2E4!\"})}),/*#__PURE__*/_jsxs(Box,{p:3,bg:\"gray.200\",borderRadius:\"md\",position:\"sticky\",top:0,zIndex:10,borderWidth:\"1px\",boxShadow:\"sm\",children:[/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",alignItems:\"center\",children:[/*#__PURE__*/_jsx(HStack,{spacing:4,children:/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Text,{fontSize:\"sm\",mb:1,color:\"black\",children:\"Class\"}),/*#__PURE__*/_jsx(Input,{value:label,onChange:handleLabelInputChange,onBlur:commitLabelChange,onKeyDown:e=>{if(e.key==='Enter')commitLabelChange();},placeholder:\"Enter label\",size:\"sm\",width:\"200px\",bg:\"white\",borderColor:\"gray.200\"})]})}),/*#__PURE__*/_jsxs(HStack,{children:[/*#__PURE__*/_jsxs(Text,{fontSize:\"sm\",mr:2,color:\"black\",children:[\"Zoom: \",formatScale(scale)]}),/*#__PURE__*/_jsx(Button,{size:\"sm\",colorScheme:\"teal\",variant:showLabels?\"solid\":\"outline\",onClick:()=>setShowLabels(prev=>!prev),children:showLabels?\"Hide Labels\":\"Show Labels\"}),/*#__PURE__*/_jsx(Button,{size:\"sm\",colorScheme:\"green\",variant:mode===\"Draw\"?\"solid\":\"outline\",onClick:()=>handleModeChange(\"Draw\"),children:\"Draw\"}),/*#__PURE__*/_jsx(Button,{size:\"sm\",colorScheme:\"blue\",variant:mode===\"Edit\"?\"solid\":\"outline\",onClick:()=>handleModeChange(\"Edit\"),children:\"Edit\"}),/*#__PURE__*/_jsx(Button,{size:\"sm\",colorScheme:\"purple\",onClick:()=>{setSaveNotification(true);setTimeout(()=>setSaveNotification(false),3000);sendToStreamlit({save_requested:true});},children:\"Save\"})]})]}),/*#__PURE__*/_jsx(Flex,{mt:2,justifyContent:\"space-between\",alignItems:\"center\",children:/*#__PURE__*/_jsxs(Text,{fontSize:\"xs\",color:\"black\",children:[\"Selected Items: \",rectangles.length]})})]}),/*#__PURE__*/_jsx(Box,{ref:canvasWrapperRef,children:/*#__PURE__*/_jsx(Center,{children:/*#__PURE__*/_jsx(BBoxCanvas,{rectangles:rectangles,mode:mode,selectedId:selectedId,scale:scale,setSelectedId:setSelectedId,setRectangles:setRectangles,setLabel:setLabel,color_map:color_map,label:label,image:image,image_size:image_size,strokeWidth:line_width,isLabelEditMode:isLabelEditMode,setIsLabelEditMode:setIsLabelEditMode,handleLabelInputChange:handleLabelInputChange,showLabels:showLabels,suggestedLabels:suggestedLabels,showSuggestions:showSuggestions,setShowSuggestions:setShowSuggestions,handleSuggestionSelect:handleSuggestionSelect,isLoadingLabels:isLoadingLabels})})})]})});};export default withStreamlitConnection(Detection);","map":{"version":3,"names":["Streamlit","withStreamlitConnection","React","useEffect","useState","useRef","ChakraProvider","Input","Box","HStack","VStack","Center","Button","Text","Flex","extendTheme","useImage","BBoxCanvas","useOcrManager","debounce","jsx","_jsx","jsxs","_jsxs","theme","config","initialColorMode","useSystemColorMode","formatBBoxes","rects","map","rect","box_id","id","bbox","x","y","width","height","label","Detection","_ref","args","image_url","image_size","bbox_info","color_map","line_width","use_space","ocr_suggestions","params","URLSearchParams","window","location","search","baseUrl","get","image","rectangles","setRectangles","bb","i","stroke","selectedId","setSelectedId","setLabel","mode","setMode","isLabelEditMode","setIsLabelEditMode","scale","setScale","saveNotification","setSaveNotification","showLabels","setShowLabels","canvasWrapperRef","requestOcrForBox","handleOcrResponse","resetOcrState","suggestedLabels","showSuggestions","isLoading","isLoadingLabels","setShowSuggestions","selectedRect","find","handleLabelInputChange","event","target","value","commitLabelChange","prev","previousOcrRef","length","JSON","stringify","current","sendToStreamlit","request_ocr","onDataFromPython","data","type","Array","isArray","error","console","addEventListener","removeEventListener","undefined","debouncedUpdateFrameHeight","setFrameHeight","scaleRef","initializeScale","scale_ratio","innerWidth","Math","min","modeRef","selectedIdRef","useSpaceRef","isLabelEditModeRef","rectanglesRef","buildPayload","_options$mode","_options$selectedBoxI","_options$save_request","_options$request_ocr","options","arguments","currentMode","selectedBoxId","currentRectangles","currentScale","selectedBox","box","payload","bboxes","save_requested","selected_box_id","selected_box_coords","setComponentValue","handleKeyPress","code","ctrlKey","preventDefault","setTimeout","filter","debouncedSetScale","newScale","handleWheel","_canvasWrapperRef$cur","contains","deltaY","max","passive","formatScale","round","handleModeChange","newMode","handleSuggestionSelect","suggestedLabel","children","spacing","align","p","bg","color","borderRadius","position","top","left","transform","zIndex","boxShadow","fontWeight","borderWidth","justifyContent","alignItems","fontSize","mb","onChange","onBlur","onKeyDown","e","key","placeholder","size","borderColor","mr","colorScheme","variant","onClick","mt","ref","strokeWidth"],"sources":["/Users/nongshim/Desktop/Python/project/streamlit_image_annotation_backup/Detection/frontend/src/Detection.tsx"],"sourcesContent":["import {\n  Streamlit,\n  withStreamlitConnection,\n  ComponentProps\n} from \"streamlit-component-lib\"\nimport React, { useEffect, useState, useRef } from \"react\"\nimport { ChakraProvider, Input, Box, HStack, VStack, Center, Button, Text, Flex } from '@chakra-ui/react'\nimport { extendTheme } from '@chakra-ui/react';\nimport useImage from 'use-image';\nimport BBoxCanvas from \"./BBoxCanvas\";\nimport { useOcrManager } from \"./useOcrManager\"; // OCR 훅\nimport debounce from 'lodash/debounce'; // 🔄 줌 최적화를 위한 debounce 추가\n\n\n// Chakra UI 테마 설정\nconst theme = extendTheme({\n  config: {\n    initialColorMode: 'light',\n    useSystemColorMode: false,\n  },\n});\n\n// Python에서 전달된 파라미터 정의\nexport interface PythonArgs {\n  image_url: string,\n  image_size: number[],\n  bbox_info: any[],\n  color_map: any,\n  line_width: number,\n  use_space: boolean,\n  ocr_suggestions: string[],\n  request_ocr?: boolean\n}\n\n// BBox 타입 정의\ninterface Rectangle {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  label: string;\n  stroke: string;\n  id: string;\n}\n\n// Python에서 사용할 형식으로 포맷\nconst formatBBoxes = (rects: Rectangle[]) =>\n  rects.map((rect) => ({\n    box_id: rect.id,\n    bbox: [rect.x, rect.y, rect.width, rect.height],\n    label: rect.label || \"\",\n  }));\n\n// 컴포넌트 본체\nconst Detection = ({ args }: ComponentProps) => {\n  const {\n    image_url,\n    image_size,\n    bbox_info,\n    color_map,\n    line_width,\n    use_space,\n    ocr_suggestions\n  }: PythonArgs = args\n\n  const params = new URLSearchParams(window.location.search);\n  const baseUrl = params.get('streamlitUrl');\n  const [image] = useImage(baseUrl + image_url);\n\n  const [rectangles, setRectangles] = useState<Rectangle[]>(\n    bbox_info.map((bb, i) => ({\n      x: bb.bbox[0],\n      y: bb.bbox[1],\n      width: bb.bbox[2],\n      height: bb.bbox[3],\n      label: bb.label,\n      stroke: \"#39FF14\",\n      id: 'bbox-' + i\n    }))\n  );\n\n  const [selectedId, setSelectedId] = useState<string | null>(null);\n  const [label, setLabel] = useState(\"\");\n  const [mode, setMode] = useState<string>('Draw');\n  const [isLabelEditMode, setIsLabelEditMode] = useState(false);\n  const [scale, setScale] = useState(1.0);\n  const [saveNotification, setSaveNotification] = useState(false);\n  const [showLabels, setShowLabels] = useState(false);\n\n  const canvasWrapperRef = useRef<HTMLDivElement>(null); // 🔍 캔버스 영역 추적용 ref\n\n  const {\n    requestOcrForBox,\n    handleOcrResponse,\n    resetOcrState,\n    suggestedLabels,\n    showSuggestions,\n    isLoading: isLoadingLabels,\n    setShowSuggestions\n  } = useOcrManager({ rectangles, scale, mode });\n\n  useEffect(() => {\n    if (selectedId) {\n      const selectedRect = rectangles.find(rect => rect.id === selectedId);\n      if (selectedRect) {\n        setLabel(selectedRect.label);\n      }\n    }\n  }, [selectedId, rectangles]);\n\n  const handleLabelInputChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    setLabel(event.target.value);\n  };\n\n  const commitLabelChange = () => {\n    if (selectedId !== null) {\n      setRectangles((prev) =>\n        prev.map((rect) =>\n          rect.id === selectedId ? { ...rect, label: label, stroke: \"#39FF14\" } : rect\n        )\n      );\n    }\n  };\n\n  // // OCR 요청을 위한 함수\n  // useEffect(() => {\n  //   if (args.ocr_suggestions && args.ocr_suggestions.length > 0) {\n  //     handleOcrResponse(args.ocr_suggestions);\n  //   }\n  // }, [args.ocr_suggestions]);\n  \n  const previousOcrRef = useRef<string[] | null>(null); // ✅ 이전 OCR 결과 캐시\n\n  useEffect(() => {\n    if (\n      args.ocr_suggestions &&\n      args.ocr_suggestions.length > 0 &&\n      JSON.stringify(args.ocr_suggestions) !== JSON.stringify(previousOcrRef.current)\n    ) {\n      previousOcrRef.current = args.ocr_suggestions; // ✅ 중복 방지용 캐시 업데이트\n      handleOcrResponse(args.ocr_suggestions); // ✅ OCR 결과 반영\n      sendToStreamlit({ request_ocr: false }); // ✅ JS 측에서도 OCR 요청 종료 신호\n    }\n  }, [args.ocr_suggestions]);\n\n  // OCR 응답을 처리하는 함수\n  useEffect(() => {\n    const onDataFromPython = (event: MessageEvent) => {\n      if (event.data.type === 'streamlit:render') {\n        try {\n          const args = event.data.args;\n          if (args?.ocr_suggestions && Array.isArray(args.ocr_suggestions)) {\n            handleOcrResponse(args.ocr_suggestions);\n          }\n        } catch (error) {\n          console.error(\"Error handling OCR suggestions from message:\", error);\n        }\n      }\n    };\n    window.addEventListener('message', onDataFromPython);\n    return () => window.removeEventListener('message', onDataFromPython);\n  }, []);\n\n  useEffect(() => {\n    if (args.request_ocr === false || args.request_ocr === undefined) {\n      resetOcrState();\n    }\n  }, [args.request_ocr]);\n\n  // 🔄 줌 최적화를 위한 debounce 설정\n  const debouncedUpdateFrameHeight = debounce(() => {\n    if (image_size[1] > 0) {\n      Streamlit.setFrameHeight(image_size[1] * scaleRef.current + 100);\n    }\n  }, 100); // ← 100ms 안에 1번만 실행\n  \n  useEffect(() => {\n    const initializeScale = () => {\n      if (scale === 1.0 && image_size[0] > 0) {\n        const scale_ratio = window.innerWidth * 0.8 / image_size[0];\n        setScale(Math.min(scale_ratio, 1.0));\n      }\n    };\n\n    initializeScale();\n    debouncedUpdateFrameHeight();\n    window.addEventListener('resize', debouncedUpdateFrameHeight);\n    return () => {\n      window.removeEventListener('resize', debouncedUpdateFrameHeight);\n    };\n  }, [image_size, scale]);\n\n  const modeRef = useRef(mode);\n  const selectedIdRef = useRef(selectedId);\n  const useSpaceRef = useRef(use_space);\n  const isLabelEditModeRef = useRef(isLabelEditMode);\n  const rectanglesRef = useRef(rectangles);\n  const scaleRef = useRef(scale);\n\n  useEffect(() => { modeRef.current = mode }, [mode]);\n  useEffect(() => { selectedIdRef.current = selectedId }, [selectedId]);\n  useEffect(() => { useSpaceRef.current = use_space }, [use_space]);\n  useEffect(() => { isLabelEditModeRef.current = isLabelEditMode }, [isLabelEditMode]);\n  useEffect(() => { rectanglesRef.current = rectangles }, [rectangles]);\n  useEffect(() => { scaleRef.current = scale }, [scale]);\n\n  const buildPayload = (options: {\n    mode?: string;\n    selectedBoxId?: string | null;\n    save_requested?: boolean;\n    request_ocr?: boolean;\n  } = {}) => {\n    const currentMode = options.mode ?? modeRef.current;\n    const selectedBoxId = options.selectedBoxId ?? selectedIdRef.current;\n    const currentRectangles = rectanglesRef.current;\n    const currentScale = scaleRef.current;\n\n    const selectedBox = currentRectangles.find(box => box.id === selectedBoxId);\n\n    const payload: any = {\n      mode: currentMode,\n      bboxes: formatBBoxes(currentRectangles),\n      scale: currentScale,\n      save_requested: options.save_requested ?? false,\n      request_ocr: options.request_ocr ?? false\n    };\n\n    if (selectedBox) {\n      payload.selected_box_id = selectedBox.id;\n      payload.selected_box_coords = [\n        selectedBox.x,\n        selectedBox.y,\n        selectedBox.width,\n        selectedBox.height\n      ];\n    }\n\n    return payload;\n  };\n\n  const sendToStreamlit = (options = {}) => {\n    const payload = buildPayload(options);\n    Streamlit.setComponentValue(payload);\n  };\n\n  useEffect(() => {\n    const handleKeyPress = (event: KeyboardEvent) => {\n      const mode = modeRef.current;\n      const selectedId = selectedIdRef.current;\n      const use_space = useSpaceRef.current;\n      const isLabelEditMode = isLabelEditModeRef.current;\n      const rectangles = rectanglesRef.current;\n\n      if (use_space && event.code === \"Space\") {\n        sendToStreamlit();\n      }\n\n      if (event.ctrlKey && event.code === \"KeyE\") {\n        event.preventDefault();\n        setMode(\"Edit\");\n        sendToStreamlit({ mode: \"Edit\" });\n      }\n\n      if (event.ctrlKey && event.code === \"KeyD\") {\n        event.preventDefault();\n        setMode(\"Draw\");\n        sendToStreamlit({ mode: \"Draw\" });\n      }\n\n      if (event.ctrlKey && event.code === \"KeyL\") {\n        event.preventDefault();\n        if (selectedId) {\n          setIsLabelEditMode(true);\n          setShowSuggestions(true);\n        }\n      }\n\n      if (event.ctrlKey && event.code === \"KeyM\") {\n        event.preventDefault();\n        if (selectedId) {\n          requestOcrForBox(selectedId);\n        }\n      }\n\n      if (event.ctrlKey && event.code === \"KeyR\") {\n        event.preventDefault();\n        setShowLabels(prev => !prev);\n      }\n\n      if (event.ctrlKey && event.code === \"KeyS\") {\n        event.preventDefault();\n        setSaveNotification(true);\n        setTimeout(() => {\n          setSaveNotification(false);\n        }, 3000);\n        sendToStreamlit({ save_requested: true });\n      }\n\n      if (event.code === \"Delete\" && selectedId) {\n        event.preventDefault();\n        setRectangles((prev) => prev.filter((rect) => rect.id !== selectedId));\n        setSelectedId(null);\n        setIsLabelEditMode(false);\n      }\n\n      if (event.code === \"Escape\") {\n        event.preventDefault();\n        if (isLabelEditMode || selectedId) {\n          setIsLabelEditMode(false);\n          setSelectedId(null);\n        }\n      }\n      \n    };\n\n    window.addEventListener(\"keydown\", handleKeyPress);\n    return () => {\n      window.removeEventListener(\"keydown\", handleKeyPress);\n    };\n  }, []);\n\n  useEffect(() => {\n    const debouncedSetScale = debounce((newScale: number) => {\n      setScale(newScale);\n    }, 50);\n\n    const handleWheel = (event: WheelEvent) => {\n      if (event.ctrlKey && canvasWrapperRef.current?.contains(event.target as Node)) {\n        event.preventDefault();\n        let newScale = scaleRef.current + (event.deltaY < 0 ? 0.1 : -0.1);\n        newScale = Math.min(Math.max(newScale, 0.5), 3.0);\n        debouncedSetScale(newScale);\n      }\n    };\n\n    window.addEventListener('wheel', handleWheel, { passive: false });\n    return () => {\n      window.removeEventListener('wheel', handleWheel);\n    };\n  }, []);\n\n  const formatScale = (scale: number) => `${Math.round(scale * 100)}%`;\n\n  const handleModeChange = (newMode: string) => {\n    setMode(newMode);\n    sendToStreamlit({ mode: newMode });\n  };\n\n  const handleSuggestionSelect = (suggestedLabel: string) => {\n    setLabel(suggestedLabel);\n    if (selectedId !== null) {\n      setRectangles((prev) =>\n        prev.map((rect) =>\n          rect.id === selectedId ? { ...rect, label: suggestedLabel, stroke: \"#39FF14\" } : rect\n        )\n      );\n    }\n    setShowSuggestions(false);\n  };\n\n  return (\n    <ChakraProvider theme={theme}>\n      <VStack spacing={4} align=\"stretch\">\n        {saveNotification && (\n          <Box p={3} bg=\"green.100\" color=\"green.800\" borderRadius=\"md\" position=\"fixed\" top=\"20px\" left=\"50%\" transform=\"translateX(-50%)\" zIndex={100} boxShadow=\"md\">\n            <Text fontWeight=\"bold\">💾 어노테이션 저장 요청이 전송되었습니다!</Text>\n          </Box>\n        )}\n\n        <Box p={3} bg=\"gray.200\" borderRadius=\"md\" position=\"sticky\" top={0} zIndex={10} borderWidth=\"1px\" boxShadow=\"sm\">\n          <Flex justifyContent=\"space-between\" alignItems=\"center\">\n            <HStack spacing={4}>\n              <Box>\n                <Text fontSize=\"sm\" mb={1} color=\"black\">Class</Text>\n                <Input\n                  value={label}\n                  onChange={handleLabelInputChange}\n                  onBlur={commitLabelChange}\n                  onKeyDown={(e) => { if (e.key === 'Enter') commitLabelChange(); }}\n                  placeholder=\"Enter label\"\n                  size=\"sm\"\n                  width=\"200px\"\n                  bg=\"white\"\n                  borderColor=\"gray.200\"\n                />\n              </Box>\n            </HStack>\n\n            <HStack>\n              <Text fontSize=\"sm\" mr={2} color=\"black\">Zoom: {formatScale(scale)}</Text>\n              <Button size=\"sm\" colorScheme=\"teal\" variant={showLabels ? \"solid\" : \"outline\"} onClick={() => setShowLabels(prev => !prev)}>\n                {showLabels ? \"Hide Labels\" : \"Show Labels\"}\n              </Button>\n              <Button size=\"sm\" colorScheme=\"green\" variant={mode === \"Draw\" ? \"solid\" : \"outline\"} onClick={() => handleModeChange(\"Draw\")}>Draw</Button>\n              <Button size=\"sm\" colorScheme=\"blue\" variant={mode === \"Edit\" ? \"solid\" : \"outline\"} onClick={() => handleModeChange(\"Edit\")}>Edit</Button>\n              <Button size=\"sm\" colorScheme=\"purple\" onClick={() => {\n                setSaveNotification(true);\n                setTimeout(() => setSaveNotification(false), 3000);\n                sendToStreamlit({ save_requested: true });\n              }}>\n                Save\n              </Button>\n            </HStack>\n          </Flex>\n\n          <Flex mt={2} justifyContent=\"space-between\" alignItems=\"center\">\n            <Text fontSize=\"xs\" color=\"black\">Selected Items: {rectangles.length}</Text>\n          </Flex>\n        </Box>\n\n        <Box ref={canvasWrapperRef}>\n          <Center>\n            <BBoxCanvas\n              rectangles={rectangles}\n              mode={mode}\n              selectedId={selectedId}\n              scale={scale}\n              setSelectedId={setSelectedId}\n              setRectangles={setRectangles}\n              setLabel={setLabel}\n              color_map={color_map}\n              label={label}\n              image={image}\n              image_size={image_size}\n              strokeWidth={line_width}\n              isLabelEditMode={isLabelEditMode}\n              setIsLabelEditMode={setIsLabelEditMode}\n              handleLabelInputChange={handleLabelInputChange}\n              showLabels={showLabels}\n              suggestedLabels={suggestedLabels}\n              showSuggestions={showSuggestions}\n              setShowSuggestions={setShowSuggestions}\n              handleSuggestionSelect={handleSuggestionSelect}\n              isLoadingLabels={isLoadingLabels}\n            />\n          </Center>\n        </Box>\n      </VStack>\n    </ChakraProvider>\n  );\n};\n\nexport default withStreamlitConnection(Detection);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}