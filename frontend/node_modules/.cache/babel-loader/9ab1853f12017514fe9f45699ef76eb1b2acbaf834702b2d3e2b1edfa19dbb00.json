{"ast":null,"code":"import{Streamlit,withStreamlitConnection}from\"streamlit-component-lib\";import React,{useEffect,useState,useRef}from\"react\";import{ChakraProvider,Input,Box,HStack,VStack,Center,Button,Text,Flex}from'@chakra-ui/react';import{extendTheme}from'@chakra-ui/react';import useImage from'use-image';import BBoxCanvas from\"./BBoxCanvas\";import debounce from'lodash/debounce';// ÌÖåÎßà ÏÑ§Ï†ï - Í∞ïÏ†ú ÎùºÏù¥Ìä∏ Î™®Îìú\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const theme=extendTheme({config:{initialColorMode:'light',useSystemColorMode:false}});const Detection=_ref=>{let{args}=_ref;const{image_url,image_size,bbox_info,color_map,line_width,use_space,ocr_suggestions}=args;const params=new URLSearchParams(window.location.search);const baseUrl=params.get('streamlitUrl');const[image]=useImage(baseUrl+image_url);const[rectangles,setRectangles]=React.useState(bbox_info.map((bb,i)=>({x:bb.bbox[0],y:bb.bbox[1],width:bb.bbox[2],height:bb.bbox[3],label:bb.label,stroke:\"#39FF14\",// color_map[bb.label],\nid:'bbox-'+i})));const[selectedId,setSelectedId]=React.useState(null);const[label,setLabel]=useState(\"\");const[mode,setMode]=React.useState('Draw');const[isLabelEditMode,setIsLabelEditMode]=useState(false);const[scale,setScale]=useState(1.0);const[saveNotification,setSaveNotification]=useState(false);const[showLabels,setShowLabels]=useState(false);const[suggestedLabels,setSuggestedLabels]=useState([]);const[isLoadingLabels,setIsLoadingLabels]=useState(false);const[showSuggestions,setShowSuggestions]=useState(false);useEffect(()=>{if(ocr_suggestions&&ocr_suggestions.length>0){console.log(\"Received OCR suggestions from props:\",ocr_suggestions);setSuggestedLabels(ocr_suggestions);setIsLoadingLabels(false);setShowSuggestions(true);}},[ocr_suggestions]);// Streamlit Ïª¥Ìè¨ÎÑåÌä∏ ÌÜµÏã† Í∞úÏÑ†\nconst sendStateToStreamlit=function(currentMode,boxesData,currentScale){let selectedBoxId=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;try{// ÌïÑÏöîÌïú Îç∞Ïù¥ÌÑ∞Îßå Ï†ÑÏÜ°ÌïòÎèÑÎ°ù ÏµúÏ†ÅÌôî\nconst currentBboxValue=boxesData.map(rect=>({box_id:rect.id,bbox:[rect.x,rect.y,rect.width,rect.height],label:rect.label||\"\"// Îπà ÎùºÎ≤® ÏïàÏ†ÑÌïòÍ≤å Ï≤òÎ¶¨\n}));// OCR ÏöîÏ≤≠ ÏãúÏóêÎßå full data Ï†ÑÏÜ°, ÏïÑÎãê ÎïåÎäî ÏµúÏÜå Îç∞Ïù¥ÌÑ∞Îßå\nif(selectedBoxId!==null){console.log(\"DEBUG: OCR ÏöîÏ≤≠ Ï†ÑÏÜ°\",selectedBoxId);// ÏÑ†ÌÉùÎêú Î∞ïÏä§Í∞Ä Ï°¥Ïû¨ÌïòÎäîÏßÄ ÌôïÏù∏\nconst selectedBox=boxesData.find(box=>box.id===selectedBoxId);if(!selectedBox){console.error(\"ÏÑ†ÌÉùÎêú Î∞ïÏä§Î•º Ï∞æÏùÑ Ïàò ÏóÜÏùå\");return;}Streamlit.setComponentValue({mode:currentMode,bboxes:currentBboxValue,scale:currentScale,save_requested:false,request_ocr:true,selected_box_id:selectedBoxId,selected_box_coords:[selectedBox.x,selectedBox.y,selectedBox.width,selectedBox.height]});}else{// ÏùºÎ∞ò ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ÏóêÏÑúÎäî OCR Í¥ÄÎ†® ÌîåÎûòÍ∑∏ Ï†úÏô∏\nStreamlit.setComponentValue({mode:currentMode,bboxes:currentBboxValue,scale:currentScale,save_requested:false});}}catch(error){console.error(\"ÏÉÅÌÉú Ï†ÑÏÜ° Ï§ë Ïò§Î•ò Î∞úÏÉù:\",error);}};const pendingOCRRequestRef=useRef(false);// const sendOCRRequest = (selectedId: string, mode: string, rectangles: Rectangle[], scale: number) => {\n//   if (pendingOCRRequestRef.current) {\n//     console.log(\"Ïù¥ÎØ∏ Ï≤òÎ¶¨ Ï§ëÏù∏ OCR ÏöîÏ≤≠Ïù¥ ÏûàÏäµÎãàÎã§\");\n//     return;\n//   }\n//   pendingOCRRequestRef.current = true;\n//   // ÏÑ†ÌÉùÎêú IDÏóê Ìï¥ÎãπÌïòÎäî Ïù∏Îç±Ïä§ Ï∞æÍ∏∞\n//   const selectedIndex = rectangles.findIndex(rect => rect.id === selectedId);\n//   // Ïù∏Îç±Ïä§Î•º Ï∞æÏïòÏùÑ ÎïåÎßå ÏöîÏ≤≠ Ï†ÑÏÜ°\n//   if (selectedIndex !== -1) {\n//     // OCR ÏöîÏ≤≠ Î≥¥ÎÇ¥Í∏∞\n//     Streamlit.setComponentValue({\n//       mode: mode,\n//       bboxes: rectangles.map((rect) => ({\n//         bbox: [rect.x, rect.y, rect.width, rect.height],\n//         label: rect.label,\n//       })),\n//       scale: scale,\n//       request_ocr: true,\n//       selected_box_index: selectedIndex  // ID ÎåÄÏã† Ïù∏Îç±Ïä§ Ï†ÑÏÜ°\n//     });\n//   } else {\n//     console.error(\"ÏÑ†ÌÉùÎêú IDÏóê Ìï¥ÎãπÌïòÎäî Î∞îÏö¥Îî© Î∞ïÏä§Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§:\", selectedId);\n//   }\n//   // ÏöîÏ≤≠ ÌîåÎûòÍ∑∏ Ï¥àÍ∏∞Ìôî (ÏùºÏ†ï ÏãúÍ∞Ñ ÌõÑ)\n//   setTimeout(() => {\n//     pendingOCRRequestRef.current = false;\n//   }, 1000);\n// };\n// Î©îÏãúÏßÄ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏàòÏ†ï\nconst sendOCRRequest=debounce(selectedId=>{const selectedBox=rectangles.find(rect=>rect.id===selectedId);if(!selectedBox)return;Streamlit.setComponentValue({mode,bboxes:rectangles.map(rect=>({box_id:rect.id,bbox:[rect.x,rect.y,rect.width,rect.height],label:rect.label})),scale,request_ocr:true,selected_box_id:selectedId,selected_box_coords:[selectedBox.x,selectedBox.y,selectedBox.width,selectedBox.height]});},500);// debounceÎ°ú rerun Î∞©ÏßÄ\nuseEffect(()=>{const onDataFromPython=event=>{if(event.data.type==='streamlit:render'){console.log(\"Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞:\",event.data.args);console.log(\"Ïª¥Ìè¨ÎÑåÌä∏ Îç∞Ïù¥ÌÑ∞:\",event.data.args.data);try{const data=event.data.args.data;// OCR Ï∂îÏ≤ú Í≤∞Í≥º Ï≤òÎ¶¨ Í∞úÏÑ†\nif(data&&data.ocr_suggestions&&Array.isArray(data.ocr_suggestions)){console.log(\"DEBUG: OCR Ï∂îÏ≤ú Î™©Î°ù Î∞õÏùå:\",data.ocr_suggestions);// ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏Î•º ÏùºÍ¥ÑÏ†ÅÏúºÎ°ú Ï≤òÎ¶¨\nsetSuggestedLabels(data.ocr_suggestions);setIsLoadingLabels(false);setShowSuggestions(true);// ÎîîÎ≤ÑÍπÖ: Ïã§Ï†úÎ°ú UIÏóê ÌëúÏãúÎêòÎäîÏßÄ ÌôïÏù∏\nsetTimeout(()=>{console.log(\"DEBUG: UI ÏÉÅÌÉú ÏµúÏ¢Ö ÌôïÏù∏\",{suggestedLabels:data.ocr_suggestions,showSuggestions:true});},100);}}catch(error){console.error(\"Ïò§Î•ò Î∞úÏÉù:\",error);}}};window.addEventListener('message',onDataFromPython);return()=>window.removeEventListener('message',onDataFromPython);},[setSuggestedLabels,setIsLoadingLabels,setShowSuggestions]);// ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ìï®ÏàòÎì§ÏùÑ ÏùòÏ°¥ÏÑ± Î∞∞Ïó¥Ïóê Ï∂îÍ∞Ä\n// ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Î∞ïÏä§Ïùò ÎùºÎ≤®Î°ú ÏûÖÎ†•ÎûÄ ÏóÖÎç∞Ïù¥Ìä∏\nuseEffect(()=>{if(selectedId){const selectedRect=rectangles.find(rect=>rect.id===selectedId);if(selectedRect){setLabel(selectedRect.label);}}},[selectedId,rectangles]);// Î™®ÎìúÍ∞Ä Î≥ÄÍ≤ΩÎê† ÎïåÎßàÎã§ StreamlitÏúºÎ°ú Ï†ÑÏÜ°\nuseEffect(()=>{sendStateToStreamlit(mode,rectangles,scale);},[mode,rectangles]);// Î™®Îìú Î≥ÄÍ≤ΩÏù¥ Ï†úÎåÄÎ°ú ÎêòÎäîÏßÄ ÌôïÏù∏\nuseEffect(()=>{console.log(\"ÌòÑÏû¨ Î™®Îìú:\",mode);},[mode]);// ÏÇ¨Ïö©Ïûê ÏûÖÎ†•ÏùÑ Î∞òÏòÅÌïòÎäî Ìï®Ïàò\nconst handleLabelInputChange=event=>{const newLabel=event.target.value;setLabel(newLabel);if(selectedId!==null){setRectangles(prev=>prev.map(rect=>rect.id===selectedId?{...rect,label:newLabel,stroke:\"#39FF14\"}:rect// color_map[newLabel] || \"#FF0000\" } : rect\n));}};// Ï∫îÎ≤ÑÏä§ ÌÅ¨Í∏∞ Ï°∞Ï†ï\nuseEffect(()=>{// Ï¥àÍ∏∞ Ïä§ÏºÄÏùº ÏÑ§Ï†ï Î∞è ÌîÑÎ†àÏûÑ ÎÜíÏù¥ Ï°∞Ï†ïÏùÑ ÌïòÎÇòÏùò useEffectÎ°ú ÌÜµÌï©\nconst initializeScale=()=>{// ÏµúÏ¥à Î°úÎìú Ïãú Ï¥àÍ∏∞ Ïä§ÏºÄÏùº Í≥ÑÏÇ∞\nif(scale===1.0&&image_size[0]>0){const scale_ratio=window.innerWidth*0.8/image_size[0];setScale(Math.min(scale_ratio,1.0));}};const updateFrameHeight=()=>{// ÌòÑÏû¨ Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞ÏôÄ Ïä§ÏºÄÏùº Í∏∞Î∞òÏúºÎ°ú ÌîÑÎ†àÏûÑ ÎÜíÏù¥ Ï°∞Ï†ï\nif(image_size[1]>0){Streamlit.setFrameHeight(image_size[1]*scale+100);}};// Ï¥àÍ∏∞Ìôî Î∞è Ï≤´ Î≤àÏß∏ ÌîÑÎ†àÏûÑ ÎÜíÏù¥ ÏÑ§Ï†ï\ninitializeScale();updateFrameHeight();// ÏúàÎèÑÏö∞ Î¶¨ÏÇ¨Ïù¥Ï¶à Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà\nwindow.addEventListener('resize',updateFrameHeight);return()=>{window.removeEventListener('resize',updateFrameHeight);};},[image_size,scale]);// Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞ÏôÄ Ïä§ÏºÄÏùº ÏùòÏ°¥ÏÑ± Ï∂îÍ∞Ä\n// ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§ Ï≤òÎ¶¨\nuseEffect(()=>{const handleKeyPress=event=>{console.log(\"keydown Ïù¥Î≤§Ìä∏ Í∞êÏßÄÎê®:\",event.code,\"Ctrl:\",event.ctrlKey,\"Shift:\",event.shiftKey);if(use_space&&event.code===\"Space\"){sendStateToStreamlit(mode,rectangles,scale);}if(event.ctrlKey&&event.code===\"KeyE\"){event.preventDefault();console.log(\"Î≥ÄÍ≤Ω: Edit Î™®ÎìúÎ°ú Ï†ÑÌôò\");setMode(\"Edit\");}if(event.ctrlKey&&event.code===\"KeyD\"){event.preventDefault();console.log(\"Î≥ÄÍ≤Ω: Draw Î™®ÎìúÎ°ú Ï†ÑÌôò\");setMode(\"Draw\");}// // ÎùºÎ≤® ÏûÖÎ†• Î™®Îìú ÌÜ†Í∏Ä (Ctrl + L)\n// if (event.ctrlKey && event.code === \"KeyL\") {\n//   event.preventDefault();\n//   console.log(\"Ctrl+L Í∞êÏßÄ, ÏÑ†ÌÉùÎêú ID:\", selectedId);\n//   if (selectedId) {\n//     // ÏÉÅÌÉú Î≥ÄÍ≤ΩÏùÑ ÏùºÍ¥Ñ Ï≤òÎ¶¨ÌïòÍ≥† Ìï®ÏàòÌòï ÏóÖÎç∞Ïù¥Ìä∏ ÏÇ¨Ïö©\n//     setIsLabelEditMode(true);\n//     setShowSuggestions(true);\n//     // OCR ÏöîÏ≤≠ÏùÑ Îã§Ïùå Î†åÎçîÎßÅ ÏÇ¨Ïù¥ÌÅ¥Î°ú ÏßÄÏó∞\n//     // Î†åÎçîÎßÅ ÏÇ¨Ïù¥ÌÅ¥Ïù¥ ÏôÑÎ£åÎêú ÌõÑ Ïã§ÌñâÎêòÎèÑÎ°ù Ìï®\n//     requestAnimationFrame(() => {\n//       setIsLoadingLabels(true);\n//       sendOCRRequest(selectedId, mode, rectangles, scale);\n//     });\n//   }\n// }\nif(event.ctrlKey&&event.code===\"KeyL\"){event.preventDefault();if(selectedId){setIsLabelEditMode(true);setShowSuggestions(true);setIsLoadingLabels(true);// ‚ùóÔ∏èOCR ÏöîÏ≤≠ÏùÑ ÏÇ¥Ïßù ÏßÄÏó∞ÏãúÏºú debounce + ÏïàÏ†ïÏÑ± ÌôïÎ≥¥\nrequestAnimationFrame(()=>{sendOCRRequest(selectedId);// debounce Ï†ÅÏö©Îêú Ìï®Ïàò\n});}}// ÎùºÎ≤® ÌëúÏãú ÌÜ†Í∏Ä (Ctrl + T)\nif(event.ctrlKey&&event.code===\"KeyT\"){event.preventDefault();console.log(\"Î≥ÄÍ≤Ω: ÎùºÎ≤® ÌëúÏãú ÌÜ†Í∏Ä\");setShowLabels(prev=>!prev);}// Ctrl+S Îã®Ï∂ïÌÇ§ Í∞êÏßÄ Ï∂îÍ∞Ä\nif(event.ctrlKey&&event.code===\"KeyS\"){event.preventDefault();console.log(\"Ctrl+S Í∞êÏßÄ: Ïñ¥ÎÖ∏ÌÖåÏù¥ÏÖò Ï†ÄÏû•\");// ÏïàÎÇ¥ ÌëúÏãú ÌôúÏÑ±Ìôî\nsetSaveNotification(true);// 3Ï¥à ÌõÑÏóê ÏïàÎÇ¥ Î©îÏãúÏßÄ Ïà®Í∏∞Í∏∞\nsetTimeout(()=>{setSaveNotification(false);},3000);// StreamlitÏúºÎ°ú Ï†ÄÏû• Î™ÖÎ†π Ï†ÑÏÜ°\nStreamlit.setComponentValue({mode:mode,bboxes:rectangles.map(rect=>({id:rect.id,bbox:[rect.x,rect.y,rect.width,rect.height],label:rect.label})),scale:scale,save_requested:true// Ï†ÄÏû• ÏöîÏ≤≠ ÌîåÎûòÍ∑∏ Ï∂îÍ∞Ä\n});}// ÏÇ≠Ï†ú Í∏∞Îä•\nif(event.code===\"Delete\"&&selectedId){event.preventDefault();console.log(\"ÏÇ≠Ï†ú: ÏÑ†ÌÉùÎêú Î∞îÏö¥Îî© Î∞ïÏä§ ÏÇ≠Ï†ú\",selectedId);setRectangles(prev=>prev.filter(rect=>rect.id!==selectedId));setSelectedId(null);setIsLabelEditMode(false);}// ESC ÌÇ§Î°ú ÎùºÎ≤® ÏûÖÎ†• Î™®Îìú Ï∑®ÏÜå Î∞è ÏÑ†ÌÉù Ìï¥Ï†ú\nif(event.code===\"Escape\"){event.preventDefault();if(isLabelEditMode){setIsLabelEditMode(false);}else if(selectedId){setSelectedId(null);}}};window.addEventListener(\"keydown\",handleKeyPress);return()=>{window.removeEventListener(\"keydown\",handleKeyPress);};},[rectangles,use_space,selectedId,isLabelEditMode,mode]);// ÎßàÏö∞Ïä§ Ìú† ÌôïÎåÄ/Ï∂ïÏÜå\nuseEffect(()=>{const handleWheel=event=>{if(event.ctrlKey){event.preventDefault();let newScale=scale+(event.deltaY<0?0.1:-0.1);newScale=Math.min(Math.max(newScale,0.5),3.0);setScale(newScale);}};window.addEventListener('wheel',handleWheel,{passive:false,capture:true});},[scale]);// Ïä§ÏºÄÏùº Ìè¨Îß∑ÌåÖ\nconst formatScale=scale=>{return`${Math.round(scale*100)}%`;};// ÎùºÏù¥Ìä∏ Î™®ÎìúÎ°ú Í≥†Ï†ïÎêú ÏÉâÏÉÅ ÏÑ§Ï†ï\nconst borderColor='gray.200';const textColor='black';const controlBgColor='gray.200';const inputbgColor='white';const handleModeChange=newMode=>{setMode(newMode);// scaleÏùÑ Ïú†ÏßÄÌïòÎ©¥ÏÑú ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏\nsendStateToStreamlit(newMode,rectangles,scale);};// ÎùºÎ≤® Ï∂îÏ≤ú ÏÑ†ÌÉù Ìï∏Îì§Îü¨ Ìï®Ïàò Ï∂îÍ∞Ä\nconst handleSuggestionSelect=suggestedLabel=>{setLabel(suggestedLabel);if(selectedId!==null){setRectangles(prev=>prev.map(rect=>rect.id===selectedId?{...rect,label:suggestedLabel,stroke:\"#39FF14\"}:rect));}setShowSuggestions(false);// ÏÑ†ÌÉù ÌõÑ Ï∂îÏ≤ú UI Îã´Í∏∞\n};return/*#__PURE__*/_jsx(ChakraProvider,{theme:theme,children:/*#__PURE__*/_jsxs(VStack,{spacing:4,align:\"stretch\",children:[saveNotification&&/*#__PURE__*/_jsx(Box,{p:3,bg:\"green.100\",color:\"green.800\",borderRadius:\"md\",position:\"fixed\",top:\"20px\",left:\"50%\",transform:\"translateX(-50%)\",zIndex:100,boxShadow:\"md\",display:\"flex\",alignItems:\"center\",justifyContent:\"center\",children:/*#__PURE__*/_jsxs(Text,{fontWeight:\"bold\",children:[/*#__PURE__*/_jsx(\"span\",{role:\"img\",\"aria-label\":\"save\",children:\"\\uD83D\\uDCBE\"}),\" \\uC5B4\\uB178\\uD14C\\uC774\\uC158 \\uC800\\uC7A5 \\uC694\\uCCAD\\uC774 \\uC804\\uC1A1\\uB418\\uC5C8\\uC2B5\\uB2C8\\uB2E4!\"]})}),/*#__PURE__*/_jsxs(Box,{p:3,bg:controlBgColor,borderRadius:\"md\",position:\"sticky\",top:0,zIndex:10,borderColor:borderColor,borderWidth:\"1px\",boxShadow:\"sm\",children:[/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",alignItems:\"center\",children:[/*#__PURE__*/_jsx(HStack,{spacing:4,children:/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Text,{fontSize:\"sm\",mb:1,color:textColor,children:\"Class\"}),/*#__PURE__*/_jsx(Input,{value:label,onChange:handleLabelInputChange,placeholder:\"Enter label\",size:\"sm\",width:\"200px\",bg:inputbgColor,borderColor:borderColor})]})}),/*#__PURE__*/_jsxs(HStack,{children:[/*#__PURE__*/_jsxs(Text,{fontSize:\"sm\",mr:2,color:textColor,children:[\"Zoom: \",formatScale(scale)]}),/*#__PURE__*/_jsx(Button,{size:\"sm\",colorScheme:\"teal\",variant:showLabels?\"solid\":\"outline\",opacity:showLabels?1:0.7,onClick:()=>setShowLabels(prev=>!prev),children:showLabels?\"Hide Labels\":\"Show Labels\"}),/*#__PURE__*/_jsx(Button,{size:\"sm\",colorScheme:\"green\",variant:mode===\"Draw\"?\"solid\":\"outline\",opacity:mode===\"Draw\"?1:0.7// onClick={() => setMode(\"Draw\")}\n,onClick:()=>handleModeChange(\"Draw\")// ÏßÅÏ†ë setMode ÎåÄÏã† Ìï∏Îì§Îü¨ ÏÇ¨Ïö©\n,children:\"Draw\"}),/*#__PURE__*/_jsx(Button,{size:\"sm\",colorScheme:\"blue\",variant:mode===\"Edit\"?\"solid\":\"outline\",opacity:mode===\"Edit\"?1:0.7,onClick:()=>setMode(\"Edit\"),children:\"Edit\"}),/*#__PURE__*/_jsx(Button,{size:\"sm\",colorScheme:\"purple\",onClick:()=>{// Ï†ÄÏû• ÏöîÏ≤≠ ÌîåÎûòÍ∑∏Î•º Ìè¨Ìï®ÌïòÏó¨ StreamlitÏúºÎ°ú Îç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ°\nsetSaveNotification(true);setTimeout(()=>setSaveNotification(false),3000);Streamlit.setComponentValue({mode:mode,bboxes:rectangles.map(rect=>({bbox:[rect.x,rect.y,rect.width,rect.height],label:rect.label})),scale:scale,save_requested:true});},children:\"Save\"})]})]}),/*#__PURE__*/_jsx(Flex,{mt:2,justifyContent:\"space-between\",alignItems:\"center\",children:/*#__PURE__*/_jsxs(Text,{fontSize:\"xs\",color:textColor,children:[\"Selected Items: \",rectangles.length]})})]}),/*#__PURE__*/_jsx(Box,{children:/*#__PURE__*/_jsx(Center,{children:/*#__PURE__*/_jsx(BBoxCanvas,{rectangles:rectangles,mode:mode,selectedId:selectedId,scale:scale,setSelectedId:setSelectedId,setRectangles:setRectangles,setLabel:setLabel,color_map:color_map,label:label,image:image,image_size:image_size,strokeWidth:line_width,isLabelEditMode:isLabelEditMode,setIsLabelEditMode:setIsLabelEditMode,handleLabelInputChange:handleLabelInputChange,showLabels:showLabels,suggestedLabels:suggestedLabels// Ïó¨Í∏∞Í∞Ä Ï†úÎåÄÎ°ú Ï†ÑÎã¨ÎêòÎäîÏßÄ ÌôïÏù∏\n,showSuggestions:showSuggestions// Ïó¨Í∏∞Í∞Ä trueÎ°ú ÏÑ§Ï†ïÎêòÎäîÏßÄ ÌôïÏù∏\n,setShowSuggestions:setShowSuggestions,handleSuggestionSelect:handleSuggestionSelect,isLoadingLabels:isLoadingLabels})})})]})});};export default withStreamlitConnection(Detection);","map":{"version":3,"names":["Streamlit","withStreamlitConnection","React","useEffect","useState","useRef","ChakraProvider","Input","Box","HStack","VStack","Center","Button","Text","Flex","extendTheme","useImage","BBoxCanvas","debounce","jsx","_jsx","jsxs","_jsxs","theme","config","initialColorMode","useSystemColorMode","Detection","_ref","args","image_url","image_size","bbox_info","color_map","line_width","use_space","ocr_suggestions","params","URLSearchParams","window","location","search","baseUrl","get","image","rectangles","setRectangles","map","bb","i","x","bbox","y","width","height","label","stroke","id","selectedId","setSelectedId","setLabel","mode","setMode","isLabelEditMode","setIsLabelEditMode","scale","setScale","saveNotification","setSaveNotification","showLabels","setShowLabels","suggestedLabels","setSuggestedLabels","isLoadingLabels","setIsLoadingLabels","showSuggestions","setShowSuggestions","length","console","log","sendStateToStreamlit","currentMode","boxesData","currentScale","selectedBoxId","arguments","undefined","currentBboxValue","rect","box_id","selectedBox","find","box","error","setComponentValue","bboxes","save_requested","request_ocr","selected_box_id","selected_box_coords","pendingOCRRequestRef","sendOCRRequest","onDataFromPython","event","data","type","Array","isArray","setTimeout","addEventListener","removeEventListener","selectedRect","handleLabelInputChange","newLabel","target","value","prev","initializeScale","scale_ratio","innerWidth","Math","min","updateFrameHeight","setFrameHeight","handleKeyPress","code","ctrlKey","shiftKey","preventDefault","requestAnimationFrame","filter","handleWheel","newScale","deltaY","max","passive","capture","formatScale","round","borderColor","textColor","controlBgColor","inputbgColor","handleModeChange","newMode","handleSuggestionSelect","suggestedLabel","children","spacing","align","p","bg","color","borderRadius","position","top","left","transform","zIndex","boxShadow","display","alignItems","justifyContent","fontWeight","role","borderWidth","fontSize","mb","onChange","placeholder","size","mr","colorScheme","variant","opacity","onClick","mt","strokeWidth"],"sources":["/Users/nongshim/Desktop/Python/project/streamlit_image_annotation_backup/Detection/frontend/src/Detection.tsx"],"sourcesContent":["import {\n  Streamlit,\n  withStreamlitConnection,\n  ComponentProps\n} from \"streamlit-component-lib\"\nimport React, { useEffect, useState, useRef } from \"react\"\nimport { ChakraProvider, Input, Box, HStack, VStack, Center, Button, Text, Flex } from '@chakra-ui/react'\nimport { extendTheme } from '@chakra-ui/react';\nimport useImage from 'use-image';\nimport BBoxCanvas from \"./BBoxCanvas\";\nimport debounce from 'lodash/debounce';\n\n// ÌÖåÎßà ÏÑ§Ï†ï - Í∞ïÏ†ú ÎùºÏù¥Ìä∏ Î™®Îìú\nconst theme = extendTheme({\n  config: {\n    initialColorMode: 'light',\n    useSystemColorMode: false,\n  },\n});\n\nexport interface PythonArgs {\n  image_url: string,\n  image_size: number[],\n  bbox_info: any[],\n  color_map: any,\n  line_width: number,\n  use_space: boolean,\n  ocr_suggestions: string[]\n}\n\ninterface Rectangle {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  label: string;\n  stroke: string;\n  id: string;\n}\n\nconst Detection = ({ args }: ComponentProps) => {\n  const {\n    image_url,\n    image_size,\n    bbox_info,\n    color_map,\n    line_width,\n    use_space,\n    ocr_suggestions\n\n  }: PythonArgs = args\n\n  const params = new URLSearchParams(window.location.search);\n  const baseUrl = params.get('streamlitUrl')\n  const [image] = useImage(baseUrl + image_url)\n\n  const [rectangles, setRectangles] = React.useState<Rectangle[]>(\n    bbox_info.map((bb, i) => ({\n      x: bb.bbox[0],\n      y: bb.bbox[1],\n      width: bb.bbox[2],\n      height: bb.bbox[3],\n      label: bb.label,\n      stroke: \"#39FF14\",  // color_map[bb.label],\n      id: 'bbox-' + i\n    }))\n  );\n  \n  const [selectedId, setSelectedId] = React.useState<string | null>(null);\n  const [label, setLabel] = useState(\"\"); \n  const [mode, setMode] = React.useState<string>('Draw');\n  const [isLabelEditMode, setIsLabelEditMode] = useState(false);\n  const [scale, setScale] = useState(1.0);\n  const [saveNotification, setSaveNotification] = useState<boolean>(false);\n  const [showLabels, setShowLabels] = useState(false);\n  const [suggestedLabels, setSuggestedLabels] = useState<string[]>([]);\n  const [isLoadingLabels, setIsLoadingLabels] = useState<boolean>(false);\n  const [showSuggestions, setShowSuggestions] = useState<boolean>(false);\n\n\n  useEffect(() => {\n    if (ocr_suggestions && ocr_suggestions.length > 0) {\n      console.log(\"Received OCR suggestions from props:\", ocr_suggestions);\n      setSuggestedLabels(ocr_suggestions);\n      setIsLoadingLabels(false);\n      setShowSuggestions(true);\n    }\n  }, [ocr_suggestions]);\n  \n  // Streamlit Ïª¥Ìè¨ÎÑåÌä∏ ÌÜµÏã† Í∞úÏÑ†\n  const sendStateToStreamlit = (currentMode: string, boxesData: Rectangle[], currentScale: number, selectedBoxId: string | null = null) => {\n    try {\n      // ÌïÑÏöîÌïú Îç∞Ïù¥ÌÑ∞Îßå Ï†ÑÏÜ°ÌïòÎèÑÎ°ù ÏµúÏ†ÅÌôî\n      const currentBboxValue = boxesData.map((rect) => ({\n        box_id: rect.id,\n        bbox: [rect.x, rect.y, rect.width, rect.height],\n        label: rect.label || \"\", // Îπà ÎùºÎ≤® ÏïàÏ†ÑÌïòÍ≤å Ï≤òÎ¶¨\n      }));\n      \n      // OCR ÏöîÏ≤≠ ÏãúÏóêÎßå full data Ï†ÑÏÜ°, ÏïÑÎãê ÎïåÎäî ÏµúÏÜå Îç∞Ïù¥ÌÑ∞Îßå\n      if (selectedBoxId !== null) {\n        console.log(\"DEBUG: OCR ÏöîÏ≤≠ Ï†ÑÏÜ°\", selectedBoxId);\n        \n        // ÏÑ†ÌÉùÎêú Î∞ïÏä§Í∞Ä Ï°¥Ïû¨ÌïòÎäîÏßÄ ÌôïÏù∏\n        const selectedBox = boxesData.find(box => box.id === selectedBoxId);\n        if (!selectedBox) {\n          console.error(\"ÏÑ†ÌÉùÎêú Î∞ïÏä§Î•º Ï∞æÏùÑ Ïàò ÏóÜÏùå\");\n          return;\n        }\n        \n        Streamlit.setComponentValue({\n          mode: currentMode,\n          bboxes: currentBboxValue,\n          scale: currentScale,\n          save_requested: false,\n          request_ocr: true,\n          selected_box_id: selectedBoxId,\n          selected_box_coords: [selectedBox.x, selectedBox.y, selectedBox.width, selectedBox.height]\n        });\n      } else {\n        // ÏùºÎ∞ò ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ÏóêÏÑúÎäî OCR Í¥ÄÎ†® ÌîåÎûòÍ∑∏ Ï†úÏô∏\n        Streamlit.setComponentValue({\n          mode: currentMode,\n          bboxes: currentBboxValue,\n          scale: currentScale,\n          save_requested: false\n        });\n      }\n    } catch (error) {\n      console.error(\"ÏÉÅÌÉú Ï†ÑÏÜ° Ï§ë Ïò§Î•ò Î∞úÏÉù:\", error);\n    }\n  };\n  \nconst pendingOCRRequestRef = useRef(false);\n\n// const sendOCRRequest = (selectedId: string, mode: string, rectangles: Rectangle[], scale: number) => {\n//   if (pendingOCRRequestRef.current) {\n//     console.log(\"Ïù¥ÎØ∏ Ï≤òÎ¶¨ Ï§ëÏù∏ OCR ÏöîÏ≤≠Ïù¥ ÏûàÏäµÎãàÎã§\");\n//     return;\n//   }\n  \n//   pendingOCRRequestRef.current = true;\n  \n//   // ÏÑ†ÌÉùÎêú IDÏóê Ìï¥ÎãπÌïòÎäî Ïù∏Îç±Ïä§ Ï∞æÍ∏∞\n//   const selectedIndex = rectangles.findIndex(rect => rect.id === selectedId);\n  \n//   // Ïù∏Îç±Ïä§Î•º Ï∞æÏïòÏùÑ ÎïåÎßå ÏöîÏ≤≠ Ï†ÑÏÜ°\n//   if (selectedIndex !== -1) {\n//     // OCR ÏöîÏ≤≠ Î≥¥ÎÇ¥Í∏∞\n//     Streamlit.setComponentValue({\n//       mode: mode,\n//       bboxes: rectangles.map((rect) => ({\n//         bbox: [rect.x, rect.y, rect.width, rect.height],\n//         label: rect.label,\n//       })),\n//       scale: scale,\n//       request_ocr: true,\n//       selected_box_index: selectedIndex  // ID ÎåÄÏã† Ïù∏Îç±Ïä§ Ï†ÑÏÜ°\n//     });\n//   } else {\n//     console.error(\"ÏÑ†ÌÉùÎêú IDÏóê Ìï¥ÎãπÌïòÎäî Î∞îÏö¥Îî© Î∞ïÏä§Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§:\", selectedId);\n//   }\n\n//   // ÏöîÏ≤≠ ÌîåÎûòÍ∑∏ Ï¥àÍ∏∞Ìôî (ÏùºÏ†ï ÏãúÍ∞Ñ ÌõÑ)\n//   setTimeout(() => {\n//     pendingOCRRequestRef.current = false;\n//   }, 1000);\n// };\n\n// Î©îÏãúÏßÄ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏàòÏ†ï\n\n\nconst sendOCRRequest = debounce((selectedId: string) => {\n  const selectedBox = rectangles.find(rect => rect.id === selectedId);\n  if (!selectedBox) return;\n\n  Streamlit.setComponentValue({\n    mode,\n    bboxes: rectangles.map(rect => ({\n      box_id: rect.id,\n      bbox: [rect.x, rect.y, rect.width, rect.height],\n      label: rect.label\n    })),\n    scale,\n    request_ocr: true,\n    selected_box_id: selectedId,\n    selected_box_coords: [selectedBox.x, selectedBox.y, selectedBox.width, selectedBox.height]\n  });\n}, 500); // debounceÎ°ú rerun Î∞©ÏßÄ\n\n\nuseEffect(() => {\n  const onDataFromPython = (event: MessageEvent) => {\n    if (event.data.type === 'streamlit:render') {\n      console.log(\"Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞:\", event.data.args);\n      console.log(\"Ïª¥Ìè¨ÎÑåÌä∏ Îç∞Ïù¥ÌÑ∞:\", event.data.args.data);\n      try {\n        const data = event.data.args.data;\n        \n        // OCR Ï∂îÏ≤ú Í≤∞Í≥º Ï≤òÎ¶¨ Í∞úÏÑ†\n        if (data && data.ocr_suggestions && Array.isArray(data.ocr_suggestions)) {\n          console.log(\"DEBUG: OCR Ï∂îÏ≤ú Î™©Î°ù Î∞õÏùå:\", data.ocr_suggestions);\n          \n          // ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏Î•º ÏùºÍ¥ÑÏ†ÅÏúºÎ°ú Ï≤òÎ¶¨\n          setSuggestedLabels(data.ocr_suggestions);\n          setIsLoadingLabels(false);\n          setShowSuggestions(true);\n          \n          // ÎîîÎ≤ÑÍπÖ: Ïã§Ï†úÎ°ú UIÏóê ÌëúÏãúÎêòÎäîÏßÄ ÌôïÏù∏\n          setTimeout(() => {\n            console.log(\"DEBUG: UI ÏÉÅÌÉú ÏµúÏ¢Ö ÌôïÏù∏\", {\n              suggestedLabels: data.ocr_suggestions,\n              showSuggestions: true\n            });\n          }, 100);\n        }\n      } catch (error) {\n        console.error(\"Ïò§Î•ò Î∞úÏÉù:\", error);\n      }\n    }\n  };\n  \n  window.addEventListener('message', onDataFromPython);\n  return () => window.removeEventListener('message', onDataFromPython);\n}, [setSuggestedLabels, setIsLoadingLabels, setShowSuggestions]); // ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ìï®ÏàòÎì§ÏùÑ ÏùòÏ°¥ÏÑ± Î∞∞Ïó¥Ïóê Ï∂îÍ∞Ä\n\n  // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Î∞ïÏä§Ïùò ÎùºÎ≤®Î°ú ÏûÖÎ†•ÎûÄ ÏóÖÎç∞Ïù¥Ìä∏\n  useEffect(() => {\n    if (selectedId) {\n      const selectedRect = rectangles.find(rect => rect.id === selectedId);\n      if (selectedRect) {\n        setLabel(selectedRect.label);\n      }\n    }\n  }, [selectedId, rectangles]);\n\n  // Î™®ÎìúÍ∞Ä Î≥ÄÍ≤ΩÎê† ÎïåÎßàÎã§ StreamlitÏúºÎ°ú Ï†ÑÏÜ°\n  useEffect(() => {\n    sendStateToStreamlit(mode, rectangles, scale);\n  }, [mode, rectangles]);\n  \n  // Î™®Îìú Î≥ÄÍ≤ΩÏù¥ Ï†úÎåÄÎ°ú ÎêòÎäîÏßÄ ÌôïÏù∏\n  useEffect(() => {\n    console.log(\"ÌòÑÏû¨ Î™®Îìú:\", mode);\n  }, [mode]);\n\n  // ÏÇ¨Ïö©Ïûê ÏûÖÎ†•ÏùÑ Î∞òÏòÅÌïòÎäî Ìï®Ïàò\n  const handleLabelInputChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const newLabel = event.target.value;\n    setLabel(newLabel);\n    if (selectedId !== null) {\n      setRectangles((prev) =>\n        prev.map((rect) =>\n          rect.id === selectedId ? { ...rect, label: newLabel, stroke: \"#39FF14\" } : rect\n      // color_map[newLabel] || \"#FF0000\" } : rect\n        )\n      );\n    }\n  };\n\n  \n  // Ï∫îÎ≤ÑÏä§ ÌÅ¨Í∏∞ Ï°∞Ï†ï\n  useEffect(() => {\n    // Ï¥àÍ∏∞ Ïä§ÏºÄÏùº ÏÑ§Ï†ï Î∞è ÌîÑÎ†àÏûÑ ÎÜíÏù¥ Ï°∞Ï†ïÏùÑ ÌïòÎÇòÏùò useEffectÎ°ú ÌÜµÌï©\n    const initializeScale = () => {\n      // ÏµúÏ¥à Î°úÎìú Ïãú Ï¥àÍ∏∞ Ïä§ÏºÄÏùº Í≥ÑÏÇ∞\n      if (scale === 1.0 && image_size[0] > 0) {\n        const scale_ratio = window.innerWidth * 0.8 / image_size[0];\n        setScale(Math.min(scale_ratio, 1.0));\n      }\n    };\n    \n    const updateFrameHeight = () => {\n      // ÌòÑÏû¨ Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞ÏôÄ Ïä§ÏºÄÏùº Í∏∞Î∞òÏúºÎ°ú ÌîÑÎ†àÏûÑ ÎÜíÏù¥ Ï°∞Ï†ï\n      if (image_size[1] > 0) {\n        Streamlit.setFrameHeight(image_size[1] * scale + 100);\n      }\n    };\n    \n    // Ï¥àÍ∏∞Ìôî Î∞è Ï≤´ Î≤àÏß∏ ÌîÑÎ†àÏûÑ ÎÜíÏù¥ ÏÑ§Ï†ï\n    initializeScale();\n    updateFrameHeight();\n    \n    // ÏúàÎèÑÏö∞ Î¶¨ÏÇ¨Ïù¥Ï¶à Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà\n    window.addEventListener('resize', updateFrameHeight);\n    return () => {\n      window.removeEventListener('resize', updateFrameHeight);\n    };\n  }, [image_size, scale]); // Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞ÏôÄ Ïä§ÏºÄÏùº ÏùòÏ°¥ÏÑ± Ï∂îÍ∞Ä\n\n\n  // ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§ Ï≤òÎ¶¨\n  useEffect(() => {\n    const handleKeyPress = (event: KeyboardEvent) => {\n      console.log(\"keydown Ïù¥Î≤§Ìä∏ Í∞êÏßÄÎê®:\", event.code, \"Ctrl:\", event.ctrlKey, \"Shift:\", event.shiftKey);\n      \n      if (use_space && event.code === \"Space\") {\n        sendStateToStreamlit(mode, rectangles, scale);  \n      }\n  \n      if (event.ctrlKey && event.code === \"KeyE\") {\n        event.preventDefault();\n        console.log(\"Î≥ÄÍ≤Ω: Edit Î™®ÎìúÎ°ú Ï†ÑÌôò\");\n        setMode(\"Edit\");\n      }\n  \n      if (event.ctrlKey && event.code === \"KeyD\") {\n        event.preventDefault();\n        console.log(\"Î≥ÄÍ≤Ω: Draw Î™®ÎìúÎ°ú Ï†ÑÌôò\");\n        setMode(\"Draw\");\n      }\n\n      // // ÎùºÎ≤® ÏûÖÎ†• Î™®Îìú ÌÜ†Í∏Ä (Ctrl + L)\n      // if (event.ctrlKey && event.code === \"KeyL\") {\n      //   event.preventDefault();\n      //   console.log(\"Ctrl+L Í∞êÏßÄ, ÏÑ†ÌÉùÎêú ID:\", selectedId);\n        \n      //   if (selectedId) {\n      //     // ÏÉÅÌÉú Î≥ÄÍ≤ΩÏùÑ ÏùºÍ¥Ñ Ï≤òÎ¶¨ÌïòÍ≥† Ìï®ÏàòÌòï ÏóÖÎç∞Ïù¥Ìä∏ ÏÇ¨Ïö©\n      //     setIsLabelEditMode(true);\n      //     setShowSuggestions(true);\n          \n      //     // OCR ÏöîÏ≤≠ÏùÑ Îã§Ïùå Î†åÎçîÎßÅ ÏÇ¨Ïù¥ÌÅ¥Î°ú ÏßÄÏó∞\n      //     // Î†åÎçîÎßÅ ÏÇ¨Ïù¥ÌÅ¥Ïù¥ ÏôÑÎ£åÎêú ÌõÑ Ïã§ÌñâÎêòÎèÑÎ°ù Ìï®\n      //     requestAnimationFrame(() => {\n      //       setIsLoadingLabels(true);\n      //       sendOCRRequest(selectedId, mode, rectangles, scale);\n      //     });\n      //   }\n      // }\n\n      if (event.ctrlKey && event.code === \"KeyL\") {\n        event.preventDefault();\n        if (selectedId) {\n          setIsLabelEditMode(true);\n          setShowSuggestions(true);\n          setIsLoadingLabels(true);\n      \n          // ‚ùóÔ∏èOCR ÏöîÏ≤≠ÏùÑ ÏÇ¥Ïßù ÏßÄÏó∞ÏãúÏºú debounce + ÏïàÏ†ïÏÑ± ÌôïÎ≥¥\n          requestAnimationFrame(() => {\n            sendOCRRequest(selectedId); // debounce Ï†ÅÏö©Îêú Ìï®Ïàò\n          });\n        }\n      }\n      \n\n      // ÎùºÎ≤® ÌëúÏãú ÌÜ†Í∏Ä (Ctrl + T)\n      if (event.ctrlKey && event.code === \"KeyT\") {\n        event.preventDefault();\n        console.log(\"Î≥ÄÍ≤Ω: ÎùºÎ≤® ÌëúÏãú ÌÜ†Í∏Ä\");\n        setShowLabels(prev => !prev);\n      }\n\n      // Ctrl+S Îã®Ï∂ïÌÇ§ Í∞êÏßÄ Ï∂îÍ∞Ä\n      if (event.ctrlKey && event.code === \"KeyS\") {\n        event.preventDefault();\n        console.log(\"Ctrl+S Í∞êÏßÄ: Ïñ¥ÎÖ∏ÌÖåÏù¥ÏÖò Ï†ÄÏû•\");\n        \n        // ÏïàÎÇ¥ ÌëúÏãú ÌôúÏÑ±Ìôî\n        setSaveNotification(true);\n        \n        // 3Ï¥à ÌõÑÏóê ÏïàÎÇ¥ Î©îÏãúÏßÄ Ïà®Í∏∞Í∏∞\n        setTimeout(() => {\n          setSaveNotification(false);\n        }, 3000);\n        \n        // StreamlitÏúºÎ°ú Ï†ÄÏû• Î™ÖÎ†π Ï†ÑÏÜ°\n        Streamlit.setComponentValue({\n          mode: mode,\n          bboxes: rectangles.map((rect) => ({\n            id: rect.id,\n            bbox: [rect.x, rect.y, rect.width, rect.height],\n            label: rect.label,\n          })),\n          scale: scale,\n          save_requested: true  // Ï†ÄÏû• ÏöîÏ≤≠ ÌîåÎûòÍ∑∏ Ï∂îÍ∞Ä\n        });\n      }\n      // ÏÇ≠Ï†ú Í∏∞Îä•\n      if (event.code === \"Delete\" && selectedId) {\n        event.preventDefault();\n        console.log(\"ÏÇ≠Ï†ú: ÏÑ†ÌÉùÎêú Î∞îÏö¥Îî© Î∞ïÏä§ ÏÇ≠Ï†ú\", selectedId);\n        setRectangles((prev) => prev.filter((rect) => rect.id !== selectedId));\n        setSelectedId(null);\n        setIsLabelEditMode(false);\n      }\n      \n      // ESC ÌÇ§Î°ú ÎùºÎ≤® ÏûÖÎ†• Î™®Îìú Ï∑®ÏÜå Î∞è ÏÑ†ÌÉù Ìï¥Ï†ú\n      if (event.code === \"Escape\") {\n        event.preventDefault();\n        if (isLabelEditMode) {\n          setIsLabelEditMode(false);\n        } else if (selectedId) {\n          setSelectedId(null);\n        }\n      }\n    };\n  \n    window.addEventListener(\"keydown\", handleKeyPress);\n    return () => {\n      window.removeEventListener(\"keydown\", handleKeyPress);\n    };\n  }, [rectangles, use_space, selectedId, isLabelEditMode, mode]);\n\n  // ÎßàÏö∞Ïä§ Ìú† ÌôïÎåÄ/Ï∂ïÏÜå\n  useEffect(() => {\n    const handleWheel = (event: WheelEvent) => {\n      if (event.ctrlKey) {\n        event.preventDefault();\n\n        let newScale = scale + (event.deltaY < 0 ? 0.1 : -0.1);\n        newScale = Math.min(Math.max(newScale, 0.5), 3.0);\n        setScale(newScale);\n      }\n    };\n\n    window.addEventListener('wheel', handleWheel, { passive: false, capture: true });\n  }, [scale]);\n\n  // Ïä§ÏºÄÏùº Ìè¨Îß∑ÌåÖ\n  const formatScale = (scale: number) => {\n    return `${Math.round(scale * 100)}%`;\n  };\n\n  // ÎùºÏù¥Ìä∏ Î™®ÎìúÎ°ú Í≥†Ï†ïÎêú ÏÉâÏÉÅ ÏÑ§Ï†ï\n  const borderColor = 'gray.200';\n  const textColor = 'black';\n  const controlBgColor = 'gray.200';\n  const inputbgColor = 'white';\n\n  const handleModeChange = (newMode: string) => {\n    setMode(newMode);\n    // scaleÏùÑ Ïú†ÏßÄÌïòÎ©¥ÏÑú ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏\n    sendStateToStreamlit(newMode, rectangles, scale);\n  };\n\n  // ÎùºÎ≤® Ï∂îÏ≤ú ÏÑ†ÌÉù Ìï∏Îì§Îü¨ Ìï®Ïàò Ï∂îÍ∞Ä\n  const handleSuggestionSelect = (suggestedLabel: string) => {\n    setLabel(suggestedLabel);\n    if (selectedId !== null) {\n      setRectangles((prev) =>\n        prev.map((rect) =>\n          rect.id === selectedId ? { ...rect, label: suggestedLabel, stroke: \"#39FF14\" } : rect\n        )\n      );\n    }\n    setShowSuggestions(false); // ÏÑ†ÌÉù ÌõÑ Ï∂îÏ≤ú UI Îã´Í∏∞\n  };\n\n  \n  return (\n    <ChakraProvider theme={theme}>\n      <VStack spacing={4} align=\"stretch\">\n        {/* Ï†ÄÏû• ÏïåÎ¶º Î©îÏãúÏßÄ */}\n        {saveNotification && (\n          <Box \n            p={3} \n            bg=\"green.100\" \n            color=\"green.800\" \n            borderRadius=\"md\" \n            position=\"fixed\" \n            top=\"20px\" \n            left=\"50%\" \n            transform=\"translateX(-50%)\" \n            zIndex={100}\n            boxShadow=\"md\"\n            display=\"flex\"\n            alignItems=\"center\"\n            justifyContent=\"center\"\n          >\n            <Text fontWeight=\"bold\">\n              <span role=\"img\" aria-label=\"save\">üíæ</span> Ïñ¥ÎÖ∏ÌÖåÏù¥ÏÖò Ï†ÄÏû• ÏöîÏ≤≠Ïù¥ Ï†ÑÏÜ°ÎêòÏóàÏäµÎãàÎã§!\n            </Text>\n          </Box>\n        )}\n        \n        {/* ÏÉÅÎã® Ïª®Ìä∏Î°§ ÏòÅÏó≠ */}\n        <Box \n          p={3} \n          bg={controlBgColor} \n          borderRadius=\"md\" \n          position=\"sticky\" \n          top={0} \n          zIndex={10}\n          borderColor={borderColor}\n          borderWidth=\"1px\"\n          boxShadow=\"sm\"\n        >\n          <Flex justifyContent=\"space-between\" alignItems=\"center\">\n            <HStack spacing={4}>\n              {/* ÎùºÎ≤® ÏûÖÎ†• */}\n              <Box>\n                <Text fontSize=\"sm\" mb={1} color={textColor}>Class</Text>\n                <Input \n                  value={label} \n                  onChange={handleLabelInputChange} \n                  placeholder=\"Enter label\"\n                  size=\"sm\"\n                  width=\"200px\"\n                  bg={inputbgColor}\n                  borderColor={borderColor}\n                />\n              </Box>\n            </HStack>\n            \n            <HStack>\n              <Text fontSize=\"sm\" mr={2} color={textColor}>Zoom: {formatScale(scale)}</Text>\n              <Button \n                size=\"sm\" \n                colorScheme=\"teal\"\n                variant={showLabels ? \"solid\" : \"outline\"}\n                opacity={showLabels ? 1 : 0.7}\n                onClick={() => setShowLabels(prev => !prev)}\n              >\n                {showLabels ? \"Hide Labels\" : \"Show Labels\"}\n              </Button>\n\n              <Button \n                size=\"sm\" \n                colorScheme=\"green\"\n                variant={mode === \"Draw\" ? \"solid\" : \"outline\"}\n                opacity={mode === \"Draw\" ? 1 : 0.7}\n                // onClick={() => setMode(\"Draw\")}\n                onClick={() => handleModeChange(\"Draw\")} // ÏßÅÏ†ë setMode ÎåÄÏã† Ìï∏Îì§Îü¨ ÏÇ¨Ïö©\n              >\n                Draw\n              </Button>\n              <Button \n                size=\"sm\" \n                colorScheme=\"blue\"\n                variant={mode === \"Edit\" ? \"solid\" : \"outline\"}\n                opacity={mode === \"Edit\" ? 1 : 0.7}\n                onClick={() => setMode(\"Edit\")}\n              >\n                Edit\n              </Button>\n              <Button \n                size=\"sm\" \n                colorScheme=\"purple\"\n                onClick={() => {\n                  // Ï†ÄÏû• ÏöîÏ≤≠ ÌîåÎûòÍ∑∏Î•º Ìè¨Ìï®ÌïòÏó¨ StreamlitÏúºÎ°ú Îç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ°\n                  setSaveNotification(true);\n                  setTimeout(() => setSaveNotification(false), 3000);\n                  \n                  Streamlit.setComponentValue({\n                    mode: mode,\n                    bboxes: rectangles.map((rect) => ({\n                      bbox: [rect.x, rect.y, rect.width, rect.height],\n                      label: rect.label,\n                    })),\n                    scale: scale,\n                    save_requested: true\n                  });\n                }}\n              >\n                Save\n              </Button>\n            </HStack>\n          </Flex>\n          \n          <Flex mt={2} justifyContent=\"space-between\" alignItems=\"center\">\n            <Text fontSize=\"xs\" color={textColor}>Selected Items: {rectangles.length}</Text>\n          </Flex>\n        </Box>\n        \n        {/* Ïù¥ÎØ∏ÏßÄ ÏòÅÏó≠ */}\n        <Box>\n          <Center>\n          <BBoxCanvas\n            rectangles={rectangles}\n            mode={mode}\n            selectedId={selectedId}\n            scale={scale}\n            setSelectedId={setSelectedId}\n            setRectangles={setRectangles}\n            setLabel={setLabel}\n            color_map={color_map}\n            label={label}\n            image={image}\n            image_size={image_size}\n            strokeWidth={line_width}\n            isLabelEditMode={isLabelEditMode}\n            setIsLabelEditMode={setIsLabelEditMode}\n            handleLabelInputChange={handleLabelInputChange}\n            showLabels={showLabels}\n            suggestedLabels={suggestedLabels} // Ïó¨Í∏∞Í∞Ä Ï†úÎåÄÎ°ú Ï†ÑÎã¨ÎêòÎäîÏßÄ ÌôïÏù∏\n            showSuggestions={showSuggestions} // Ïó¨Í∏∞Í∞Ä trueÎ°ú ÏÑ§Ï†ïÎêòÎäîÏßÄ ÌôïÏù∏\n            setShowSuggestions={setShowSuggestions}\n            handleSuggestionSelect={handleSuggestionSelect}\n            isLoadingLabels={isLoadingLabels}\n          />\n          </Center>\n        </Box>\n      </VStack>\n    </ChakraProvider>\n  );\n};\n\nexport default withStreamlitConnection(Detection);"],"mappings":"AAAA,OACEA,SAAS,CACTC,uBAAuB,KAElB,yBAAyB,CAChC,MAAO,CAAAC,KAAK,EAAIC,SAAS,CAAEC,QAAQ,CAAEC,MAAM,KAAQ,OAAO,CAC1D,OAASC,cAAc,CAAEC,KAAK,CAAEC,GAAG,CAAEC,MAAM,CAAEC,MAAM,CAAEC,MAAM,CAAEC,MAAM,CAAEC,IAAI,CAAEC,IAAI,KAAQ,kBAAkB,CACzG,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,MAAO,CAAAC,QAAQ,KAAM,WAAW,CAChC,MAAO,CAAAC,UAAU,KAAM,cAAc,CACrC,MAAO,CAAAC,QAAQ,KAAM,iBAAiB,CAEtC;AAAA,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBACA,KAAM,CAAAC,KAAK,CAAGR,WAAW,CAAC,CACxBS,MAAM,CAAE,CACNC,gBAAgB,CAAE,OAAO,CACzBC,kBAAkB,CAAE,KACtB,CACF,CAAC,CAAC,CAsBF,KAAM,CAAAC,SAAS,CAAGC,IAAA,EAA8B,IAA7B,CAAEC,IAAqB,CAAC,CAAAD,IAAA,CACzC,KAAM,CACJE,SAAS,CACTC,UAAU,CACVC,SAAS,CACTC,SAAS,CACTC,UAAU,CACVC,SAAS,CACTC,eAEU,CAAC,CAAGP,IAAI,CAEpB,KAAM,CAAAQ,MAAM,CAAG,GAAI,CAAAC,eAAe,CAACC,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAC1D,KAAM,CAAAC,OAAO,CAAGL,MAAM,CAACM,GAAG,CAAC,cAAc,CAAC,CAC1C,KAAM,CAACC,KAAK,CAAC,CAAG5B,QAAQ,CAAC0B,OAAO,CAAGZ,SAAS,CAAC,CAE7C,KAAM,CAACe,UAAU,CAAEC,aAAa,CAAC,CAAG5C,KAAK,CAACE,QAAQ,CAChD4B,SAAS,CAACe,GAAG,CAAC,CAACC,EAAE,CAAEC,CAAC,IAAM,CACxBC,CAAC,CAAEF,EAAE,CAACG,IAAI,CAAC,CAAC,CAAC,CACbC,CAAC,CAAEJ,EAAE,CAACG,IAAI,CAAC,CAAC,CAAC,CACbE,KAAK,CAAEL,EAAE,CAACG,IAAI,CAAC,CAAC,CAAC,CACjBG,MAAM,CAAEN,EAAE,CAACG,IAAI,CAAC,CAAC,CAAC,CAClBI,KAAK,CAAEP,EAAE,CAACO,KAAK,CACfC,MAAM,CAAE,SAAS,CAAG;AACpBC,EAAE,CAAE,OAAO,CAAGR,CAChB,CAAC,CAAC,CACJ,CAAC,CAED,KAAM,CAACS,UAAU,CAAEC,aAAa,CAAC,CAAGzD,KAAK,CAACE,QAAQ,CAAgB,IAAI,CAAC,CACvE,KAAM,CAACmD,KAAK,CAAEK,QAAQ,CAAC,CAAGxD,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAACyD,IAAI,CAAEC,OAAO,CAAC,CAAG5D,KAAK,CAACE,QAAQ,CAAS,MAAM,CAAC,CACtD,KAAM,CAAC2D,eAAe,CAAEC,kBAAkB,CAAC,CAAG5D,QAAQ,CAAC,KAAK,CAAC,CAC7D,KAAM,CAAC6D,KAAK,CAAEC,QAAQ,CAAC,CAAG9D,QAAQ,CAAC,GAAG,CAAC,CACvC,KAAM,CAAC+D,gBAAgB,CAAEC,mBAAmB,CAAC,CAAGhE,QAAQ,CAAU,KAAK,CAAC,CACxE,KAAM,CAACiE,UAAU,CAAEC,aAAa,CAAC,CAAGlE,QAAQ,CAAC,KAAK,CAAC,CACnD,KAAM,CAACmE,eAAe,CAAEC,kBAAkB,CAAC,CAAGpE,QAAQ,CAAW,EAAE,CAAC,CACpE,KAAM,CAACqE,eAAe,CAAEC,kBAAkB,CAAC,CAAGtE,QAAQ,CAAU,KAAK,CAAC,CACtE,KAAM,CAACuE,eAAe,CAAEC,kBAAkB,CAAC,CAAGxE,QAAQ,CAAU,KAAK,CAAC,CAGtED,SAAS,CAAC,IAAM,CACd,GAAIiC,eAAe,EAAIA,eAAe,CAACyC,MAAM,CAAG,CAAC,CAAE,CACjDC,OAAO,CAACC,GAAG,CAAC,sCAAsC,CAAE3C,eAAe,CAAC,CACpEoC,kBAAkB,CAACpC,eAAe,CAAC,CACnCsC,kBAAkB,CAAC,KAAK,CAAC,CACzBE,kBAAkB,CAAC,IAAI,CAAC,CAC1B,CACF,CAAC,CAAE,CAACxC,eAAe,CAAC,CAAC,CAErB;AACA,KAAM,CAAA4C,oBAAoB,CAAG,QAAAA,CAACC,WAAmB,CAAEC,SAAsB,CAAEC,YAAoB,CAA0C,IAAxC,CAAAC,aAA4B,CAAAC,SAAA,CAAAR,MAAA,IAAAQ,SAAA,MAAAC,SAAA,CAAAD,SAAA,IAAG,IAAI,CAClI,GAAI,CACF;AACA,KAAM,CAAAE,gBAAgB,CAAGL,SAAS,CAACnC,GAAG,CAAEyC,IAAI,GAAM,CAChDC,MAAM,CAAED,IAAI,CAAC/B,EAAE,CACfN,IAAI,CAAE,CAACqC,IAAI,CAACtC,CAAC,CAAEsC,IAAI,CAACpC,CAAC,CAAEoC,IAAI,CAACnC,KAAK,CAAEmC,IAAI,CAAClC,MAAM,CAAC,CAC/CC,KAAK,CAAEiC,IAAI,CAACjC,KAAK,EAAI,EAAI;AAC3B,CAAC,CAAC,CAAC,CAEH;AACA,GAAI6B,aAAa,GAAK,IAAI,CAAE,CAC1BN,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAEK,aAAa,CAAC,CAE9C;AACA,KAAM,CAAAM,WAAW,CAAGR,SAAS,CAACS,IAAI,CAACC,GAAG,EAAIA,GAAG,CAACnC,EAAE,GAAK2B,aAAa,CAAC,CACnE,GAAI,CAACM,WAAW,CAAE,CAChBZ,OAAO,CAACe,KAAK,CAAC,iBAAiB,CAAC,CAChC,OACF,CAEA7F,SAAS,CAAC8F,iBAAiB,CAAC,CAC1BjC,IAAI,CAAEoB,WAAW,CACjBc,MAAM,CAAER,gBAAgB,CACxBtB,KAAK,CAAEkB,YAAY,CACnBa,cAAc,CAAE,KAAK,CACrBC,WAAW,CAAE,IAAI,CACjBC,eAAe,CAAEd,aAAa,CAC9Be,mBAAmB,CAAE,CAACT,WAAW,CAACxC,CAAC,CAAEwC,WAAW,CAACtC,CAAC,CAAEsC,WAAW,CAACrC,KAAK,CAAEqC,WAAW,CAACpC,MAAM,CAC3F,CAAC,CAAC,CACJ,CAAC,IAAM,CACL;AACAtD,SAAS,CAAC8F,iBAAiB,CAAC,CAC1BjC,IAAI,CAAEoB,WAAW,CACjBc,MAAM,CAAER,gBAAgB,CACxBtB,KAAK,CAAEkB,YAAY,CACnBa,cAAc,CAAE,KAClB,CAAC,CAAC,CACJ,CACF,CAAE,MAAOH,KAAK,CAAE,CACdf,OAAO,CAACe,KAAK,CAAC,gBAAgB,CAAEA,KAAK,CAAC,CACxC,CACF,CAAC,CAEH,KAAM,CAAAO,oBAAoB,CAAG/F,MAAM,CAAC,KAAK,CAAC,CAE1C;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAGA,KAAM,CAAAgG,cAAc,CAAGnF,QAAQ,CAAEwC,UAAkB,EAAK,CACtD,KAAM,CAAAgC,WAAW,CAAG7C,UAAU,CAAC8C,IAAI,CAACH,IAAI,EAAIA,IAAI,CAAC/B,EAAE,GAAKC,UAAU,CAAC,CACnE,GAAI,CAACgC,WAAW,CAAE,OAElB1F,SAAS,CAAC8F,iBAAiB,CAAC,CAC1BjC,IAAI,CACJkC,MAAM,CAAElD,UAAU,CAACE,GAAG,CAACyC,IAAI,GAAK,CAC9BC,MAAM,CAAED,IAAI,CAAC/B,EAAE,CACfN,IAAI,CAAE,CAACqC,IAAI,CAACtC,CAAC,CAAEsC,IAAI,CAACpC,CAAC,CAAEoC,IAAI,CAACnC,KAAK,CAAEmC,IAAI,CAAClC,MAAM,CAAC,CAC/CC,KAAK,CAAEiC,IAAI,CAACjC,KACd,CAAC,CAAC,CAAC,CACHU,KAAK,CACLgC,WAAW,CAAE,IAAI,CACjBC,eAAe,CAAExC,UAAU,CAC3ByC,mBAAmB,CAAE,CAACT,WAAW,CAACxC,CAAC,CAAEwC,WAAW,CAACtC,CAAC,CAAEsC,WAAW,CAACrC,KAAK,CAAEqC,WAAW,CAACpC,MAAM,CAC3F,CAAC,CAAC,CACJ,CAAC,CAAE,GAAG,CAAC,CAAE;AAGTnD,SAAS,CAAC,IAAM,CACd,KAAM,CAAAmG,gBAAgB,CAAIC,KAAmB,EAAK,CAChD,GAAIA,KAAK,CAACC,IAAI,CAACC,IAAI,GAAK,kBAAkB,CAAE,CAC1C3B,OAAO,CAACC,GAAG,CAAC,SAAS,CAAEwB,KAAK,CAACC,IAAI,CAAC3E,IAAI,CAAC,CACvCiD,OAAO,CAACC,GAAG,CAAC,WAAW,CAAEwB,KAAK,CAACC,IAAI,CAAC3E,IAAI,CAAC2E,IAAI,CAAC,CAC9C,GAAI,CACF,KAAM,CAAAA,IAAI,CAAGD,KAAK,CAACC,IAAI,CAAC3E,IAAI,CAAC2E,IAAI,CAEjC;AACA,GAAIA,IAAI,EAAIA,IAAI,CAACpE,eAAe,EAAIsE,KAAK,CAACC,OAAO,CAACH,IAAI,CAACpE,eAAe,CAAC,CAAE,CACvE0C,OAAO,CAACC,GAAG,CAAC,sBAAsB,CAAEyB,IAAI,CAACpE,eAAe,CAAC,CAEzD;AACAoC,kBAAkB,CAACgC,IAAI,CAACpE,eAAe,CAAC,CACxCsC,kBAAkB,CAAC,KAAK,CAAC,CACzBE,kBAAkB,CAAC,IAAI,CAAC,CAExB;AACAgC,UAAU,CAAC,IAAM,CACf9B,OAAO,CAACC,GAAG,CAAC,oBAAoB,CAAE,CAChCR,eAAe,CAAEiC,IAAI,CAACpE,eAAe,CACrCuC,eAAe,CAAE,IACnB,CAAC,CAAC,CACJ,CAAC,CAAE,GAAG,CAAC,CACT,CACF,CAAE,MAAOkB,KAAK,CAAE,CACdf,OAAO,CAACe,KAAK,CAAC,QAAQ,CAAEA,KAAK,CAAC,CAChC,CACF,CACF,CAAC,CAEDtD,MAAM,CAACsE,gBAAgB,CAAC,SAAS,CAAEP,gBAAgB,CAAC,CACpD,MAAO,IAAM/D,MAAM,CAACuE,mBAAmB,CAAC,SAAS,CAAER,gBAAgB,CAAC,CACtE,CAAC,CAAE,CAAC9B,kBAAkB,CAAEE,kBAAkB,CAAEE,kBAAkB,CAAC,CAAC,CAAE;AAEhE;AACAzE,SAAS,CAAC,IAAM,CACd,GAAIuD,UAAU,CAAE,CACd,KAAM,CAAAqD,YAAY,CAAGlE,UAAU,CAAC8C,IAAI,CAACH,IAAI,EAAIA,IAAI,CAAC/B,EAAE,GAAKC,UAAU,CAAC,CACpE,GAAIqD,YAAY,CAAE,CAChBnD,QAAQ,CAACmD,YAAY,CAACxD,KAAK,CAAC,CAC9B,CACF,CACF,CAAC,CAAE,CAACG,UAAU,CAAEb,UAAU,CAAC,CAAC,CAE5B;AACA1C,SAAS,CAAC,IAAM,CACd6E,oBAAoB,CAACnB,IAAI,CAAEhB,UAAU,CAAEoB,KAAK,CAAC,CAC/C,CAAC,CAAE,CAACJ,IAAI,CAAEhB,UAAU,CAAC,CAAC,CAEtB;AACA1C,SAAS,CAAC,IAAM,CACd2E,OAAO,CAACC,GAAG,CAAC,QAAQ,CAAElB,IAAI,CAAC,CAC7B,CAAC,CAAE,CAACA,IAAI,CAAC,CAAC,CAEV;AACA,KAAM,CAAAmD,sBAAsB,CAAIT,KAA0C,EAAK,CAC7E,KAAM,CAAAU,QAAQ,CAAGV,KAAK,CAACW,MAAM,CAACC,KAAK,CACnCvD,QAAQ,CAACqD,QAAQ,CAAC,CAClB,GAAIvD,UAAU,GAAK,IAAI,CAAE,CACvBZ,aAAa,CAAEsE,IAAI,EACjBA,IAAI,CAACrE,GAAG,CAAEyC,IAAI,EACZA,IAAI,CAAC/B,EAAE,GAAKC,UAAU,CAAG,CAAE,GAAG8B,IAAI,CAAEjC,KAAK,CAAE0D,QAAQ,CAAEzD,MAAM,CAAE,SAAU,CAAC,CAAGgC,IAC/E;AACE,CACF,CAAC,CACH,CACF,CAAC,CAGD;AACArF,SAAS,CAAC,IAAM,CACd;AACA,KAAM,CAAAkH,eAAe,CAAGA,CAAA,GAAM,CAC5B;AACA,GAAIpD,KAAK,GAAK,GAAG,EAAIlC,UAAU,CAAC,CAAC,CAAC,CAAG,CAAC,CAAE,CACtC,KAAM,CAAAuF,WAAW,CAAG/E,MAAM,CAACgF,UAAU,CAAG,GAAG,CAAGxF,UAAU,CAAC,CAAC,CAAC,CAC3DmC,QAAQ,CAACsD,IAAI,CAACC,GAAG,CAACH,WAAW,CAAE,GAAG,CAAC,CAAC,CACtC,CACF,CAAC,CAED,KAAM,CAAAI,iBAAiB,CAAGA,CAAA,GAAM,CAC9B;AACA,GAAI3F,UAAU,CAAC,CAAC,CAAC,CAAG,CAAC,CAAE,CACrB/B,SAAS,CAAC2H,cAAc,CAAC5F,UAAU,CAAC,CAAC,CAAC,CAAGkC,KAAK,CAAG,GAAG,CAAC,CACvD,CACF,CAAC,CAED;AACAoD,eAAe,CAAC,CAAC,CACjBK,iBAAiB,CAAC,CAAC,CAEnB;AACAnF,MAAM,CAACsE,gBAAgB,CAAC,QAAQ,CAAEa,iBAAiB,CAAC,CACpD,MAAO,IAAM,CACXnF,MAAM,CAACuE,mBAAmB,CAAC,QAAQ,CAAEY,iBAAiB,CAAC,CACzD,CAAC,CACH,CAAC,CAAE,CAAC3F,UAAU,CAAEkC,KAAK,CAAC,CAAC,CAAE;AAGzB;AACA9D,SAAS,CAAC,IAAM,CACd,KAAM,CAAAyH,cAAc,CAAIrB,KAAoB,EAAK,CAC/CzB,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAEwB,KAAK,CAACsB,IAAI,CAAE,OAAO,CAAEtB,KAAK,CAACuB,OAAO,CAAE,QAAQ,CAAEvB,KAAK,CAACwB,QAAQ,CAAC,CAE7F,GAAI5F,SAAS,EAAIoE,KAAK,CAACsB,IAAI,GAAK,OAAO,CAAE,CACvC7C,oBAAoB,CAACnB,IAAI,CAAEhB,UAAU,CAAEoB,KAAK,CAAC,CAC/C,CAEA,GAAIsC,KAAK,CAACuB,OAAO,EAAIvB,KAAK,CAACsB,IAAI,GAAK,MAAM,CAAE,CAC1CtB,KAAK,CAACyB,cAAc,CAAC,CAAC,CACtBlD,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAC,CAC9BjB,OAAO,CAAC,MAAM,CAAC,CACjB,CAEA,GAAIyC,KAAK,CAACuB,OAAO,EAAIvB,KAAK,CAACsB,IAAI,GAAK,MAAM,CAAE,CAC1CtB,KAAK,CAACyB,cAAc,CAAC,CAAC,CACtBlD,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAC,CAC9BjB,OAAO,CAAC,MAAM,CAAC,CACjB,CAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,GAAIyC,KAAK,CAACuB,OAAO,EAAIvB,KAAK,CAACsB,IAAI,GAAK,MAAM,CAAE,CAC1CtB,KAAK,CAACyB,cAAc,CAAC,CAAC,CACtB,GAAItE,UAAU,CAAE,CACdM,kBAAkB,CAAC,IAAI,CAAC,CACxBY,kBAAkB,CAAC,IAAI,CAAC,CACxBF,kBAAkB,CAAC,IAAI,CAAC,CAExB;AACAuD,qBAAqB,CAAC,IAAM,CAC1B5B,cAAc,CAAC3C,UAAU,CAAC,CAAE;AAC9B,CAAC,CAAC,CACJ,CACF,CAGA;AACA,GAAI6C,KAAK,CAACuB,OAAO,EAAIvB,KAAK,CAACsB,IAAI,GAAK,MAAM,CAAE,CAC1CtB,KAAK,CAACyB,cAAc,CAAC,CAAC,CACtBlD,OAAO,CAACC,GAAG,CAAC,cAAc,CAAC,CAC3BT,aAAa,CAAC8C,IAAI,EAAI,CAACA,IAAI,CAAC,CAC9B,CAEA;AACA,GAAIb,KAAK,CAACuB,OAAO,EAAIvB,KAAK,CAACsB,IAAI,GAAK,MAAM,CAAE,CAC1CtB,KAAK,CAACyB,cAAc,CAAC,CAAC,CACtBlD,OAAO,CAACC,GAAG,CAAC,qBAAqB,CAAC,CAElC;AACAX,mBAAmB,CAAC,IAAI,CAAC,CAEzB;AACAwC,UAAU,CAAC,IAAM,CACfxC,mBAAmB,CAAC,KAAK,CAAC,CAC5B,CAAC,CAAE,IAAI,CAAC,CAER;AACApE,SAAS,CAAC8F,iBAAiB,CAAC,CAC1BjC,IAAI,CAAEA,IAAI,CACVkC,MAAM,CAAElD,UAAU,CAACE,GAAG,CAAEyC,IAAI,GAAM,CAChC/B,EAAE,CAAE+B,IAAI,CAAC/B,EAAE,CACXN,IAAI,CAAE,CAACqC,IAAI,CAACtC,CAAC,CAAEsC,IAAI,CAACpC,CAAC,CAAEoC,IAAI,CAACnC,KAAK,CAAEmC,IAAI,CAAClC,MAAM,CAAC,CAC/CC,KAAK,CAAEiC,IAAI,CAACjC,KACd,CAAC,CAAC,CAAC,CACHU,KAAK,CAAEA,KAAK,CACZ+B,cAAc,CAAE,IAAM;AACxB,CAAC,CAAC,CACJ,CACA;AACA,GAAIO,KAAK,CAACsB,IAAI,GAAK,QAAQ,EAAInE,UAAU,CAAE,CACzC6C,KAAK,CAACyB,cAAc,CAAC,CAAC,CACtBlD,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAErB,UAAU,CAAC,CAC5CZ,aAAa,CAAEsE,IAAI,EAAKA,IAAI,CAACc,MAAM,CAAE1C,IAAI,EAAKA,IAAI,CAAC/B,EAAE,GAAKC,UAAU,CAAC,CAAC,CACtEC,aAAa,CAAC,IAAI,CAAC,CACnBK,kBAAkB,CAAC,KAAK,CAAC,CAC3B,CAEA;AACA,GAAIuC,KAAK,CAACsB,IAAI,GAAK,QAAQ,CAAE,CAC3BtB,KAAK,CAACyB,cAAc,CAAC,CAAC,CACtB,GAAIjE,eAAe,CAAE,CACnBC,kBAAkB,CAAC,KAAK,CAAC,CAC3B,CAAC,IAAM,IAAIN,UAAU,CAAE,CACrBC,aAAa,CAAC,IAAI,CAAC,CACrB,CACF,CACF,CAAC,CAEDpB,MAAM,CAACsE,gBAAgB,CAAC,SAAS,CAAEe,cAAc,CAAC,CAClD,MAAO,IAAM,CACXrF,MAAM,CAACuE,mBAAmB,CAAC,SAAS,CAAEc,cAAc,CAAC,CACvD,CAAC,CACH,CAAC,CAAE,CAAC/E,UAAU,CAAEV,SAAS,CAAEuB,UAAU,CAAEK,eAAe,CAAEF,IAAI,CAAC,CAAC,CAE9D;AACA1D,SAAS,CAAC,IAAM,CACd,KAAM,CAAAgI,WAAW,CAAI5B,KAAiB,EAAK,CACzC,GAAIA,KAAK,CAACuB,OAAO,CAAE,CACjBvB,KAAK,CAACyB,cAAc,CAAC,CAAC,CAEtB,GAAI,CAAAI,QAAQ,CAAGnE,KAAK,EAAIsC,KAAK,CAAC8B,MAAM,CAAG,CAAC,CAAG,GAAG,CAAG,CAAC,GAAG,CAAC,CACtDD,QAAQ,CAAGZ,IAAI,CAACC,GAAG,CAACD,IAAI,CAACc,GAAG,CAACF,QAAQ,CAAE,GAAG,CAAC,CAAE,GAAG,CAAC,CACjDlE,QAAQ,CAACkE,QAAQ,CAAC,CACpB,CACF,CAAC,CAED7F,MAAM,CAACsE,gBAAgB,CAAC,OAAO,CAAEsB,WAAW,CAAE,CAAEI,OAAO,CAAE,KAAK,CAAEC,OAAO,CAAE,IAAK,CAAC,CAAC,CAClF,CAAC,CAAE,CAACvE,KAAK,CAAC,CAAC,CAEX;AACA,KAAM,CAAAwE,WAAW,CAAIxE,KAAa,EAAK,CACrC,MAAO,GAAGuD,IAAI,CAACkB,KAAK,CAACzE,KAAK,CAAG,GAAG,CAAC,GAAG,CACtC,CAAC,CAED;AACA,KAAM,CAAA0E,WAAW,CAAG,UAAU,CAC9B,KAAM,CAAAC,SAAS,CAAG,OAAO,CACzB,KAAM,CAAAC,cAAc,CAAG,UAAU,CACjC,KAAM,CAAAC,YAAY,CAAG,OAAO,CAE5B,KAAM,CAAAC,gBAAgB,CAAIC,OAAe,EAAK,CAC5ClF,OAAO,CAACkF,OAAO,CAAC,CAChB;AACAhE,oBAAoB,CAACgE,OAAO,CAAEnG,UAAU,CAAEoB,KAAK,CAAC,CAClD,CAAC,CAED;AACA,KAAM,CAAAgF,sBAAsB,CAAIC,cAAsB,EAAK,CACzDtF,QAAQ,CAACsF,cAAc,CAAC,CACxB,GAAIxF,UAAU,GAAK,IAAI,CAAE,CACvBZ,aAAa,CAAEsE,IAAI,EACjBA,IAAI,CAACrE,GAAG,CAAEyC,IAAI,EACZA,IAAI,CAAC/B,EAAE,GAAKC,UAAU,CAAG,CAAE,GAAG8B,IAAI,CAAEjC,KAAK,CAAE2F,cAAc,CAAE1F,MAAM,CAAE,SAAU,CAAC,CAAGgC,IACnF,CACF,CAAC,CACH,CACAZ,kBAAkB,CAAC,KAAK,CAAC,CAAE;AAC7B,CAAC,CAGD,mBACExD,IAAA,CAACd,cAAc,EAACiB,KAAK,CAAEA,KAAM,CAAA4H,QAAA,cAC3B7H,KAAA,CAACZ,MAAM,EAAC0I,OAAO,CAAE,CAAE,CAACC,KAAK,CAAC,SAAS,CAAAF,QAAA,EAEhChF,gBAAgB,eACf/C,IAAA,CAACZ,GAAG,EACF8I,CAAC,CAAE,CAAE,CACLC,EAAE,CAAC,WAAW,CACdC,KAAK,CAAC,WAAW,CACjBC,YAAY,CAAC,IAAI,CACjBC,QAAQ,CAAC,OAAO,CAChBC,GAAG,CAAC,MAAM,CACVC,IAAI,CAAC,KAAK,CACVC,SAAS,CAAC,kBAAkB,CAC5BC,MAAM,CAAE,GAAI,CACZC,SAAS,CAAC,IAAI,CACdC,OAAO,CAAC,MAAM,CACdC,UAAU,CAAC,QAAQ,CACnBC,cAAc,CAAC,QAAQ,CAAAf,QAAA,cAEvB7H,KAAA,CAACT,IAAI,EAACsJ,UAAU,CAAC,MAAM,CAAAhB,QAAA,eACrB/H,IAAA,SAAMgJ,IAAI,CAAC,KAAK,CAAC,aAAW,MAAM,CAAAjB,QAAA,CAAC,cAAE,CAAM,CAAC,8GAC9C,EAAM,CAAC,CACJ,CACN,cAGD7H,KAAA,CAACd,GAAG,EACF8I,CAAC,CAAE,CAAE,CACLC,EAAE,CAAEV,cAAe,CACnBY,YAAY,CAAC,IAAI,CACjBC,QAAQ,CAAC,QAAQ,CACjBC,GAAG,CAAE,CAAE,CACPG,MAAM,CAAE,EAAG,CACXnB,WAAW,CAAEA,WAAY,CACzB0B,WAAW,CAAC,KAAK,CACjBN,SAAS,CAAC,IAAI,CAAAZ,QAAA,eAEd7H,KAAA,CAACR,IAAI,EAACoJ,cAAc,CAAC,eAAe,CAACD,UAAU,CAAC,QAAQ,CAAAd,QAAA,eACtD/H,IAAA,CAACX,MAAM,EAAC2I,OAAO,CAAE,CAAE,CAAAD,QAAA,cAEjB7H,KAAA,CAACd,GAAG,EAAA2I,QAAA,eACF/H,IAAA,CAACP,IAAI,EAACyJ,QAAQ,CAAC,IAAI,CAACC,EAAE,CAAE,CAAE,CAACf,KAAK,CAAEZ,SAAU,CAAAO,QAAA,CAAC,OAAK,CAAM,CAAC,cACzD/H,IAAA,CAACb,KAAK,EACJ4G,KAAK,CAAE5D,KAAM,CACbiH,QAAQ,CAAExD,sBAAuB,CACjCyD,WAAW,CAAC,aAAa,CACzBC,IAAI,CAAC,IAAI,CACTrH,KAAK,CAAC,OAAO,CACbkG,EAAE,CAAET,YAAa,CACjBH,WAAW,CAAEA,WAAY,CAC1B,CAAC,EACC,CAAC,CACA,CAAC,cAETrH,KAAA,CAACb,MAAM,EAAA0I,QAAA,eACL7H,KAAA,CAACT,IAAI,EAACyJ,QAAQ,CAAC,IAAI,CAACK,EAAE,CAAE,CAAE,CAACnB,KAAK,CAAEZ,SAAU,CAAAO,QAAA,EAAC,QAAM,CAACV,WAAW,CAACxE,KAAK,CAAC,EAAO,CAAC,cAC9E7C,IAAA,CAACR,MAAM,EACL8J,IAAI,CAAC,IAAI,CACTE,WAAW,CAAC,MAAM,CAClBC,OAAO,CAAExG,UAAU,CAAG,OAAO,CAAG,SAAU,CAC1CyG,OAAO,CAAEzG,UAAU,CAAG,CAAC,CAAG,GAAI,CAC9B0G,OAAO,CAAEA,CAAA,GAAMzG,aAAa,CAAC8C,IAAI,EAAI,CAACA,IAAI,CAAE,CAAA+B,QAAA,CAE3C9E,UAAU,CAAG,aAAa,CAAG,aAAa,CACrC,CAAC,cAETjD,IAAA,CAACR,MAAM,EACL8J,IAAI,CAAC,IAAI,CACTE,WAAW,CAAC,OAAO,CACnBC,OAAO,CAAEhH,IAAI,GAAK,MAAM,CAAG,OAAO,CAAG,SAAU,CAC/CiH,OAAO,CAAEjH,IAAI,GAAK,MAAM,CAAG,CAAC,CAAG,GAC/B;AAAA,CACAkH,OAAO,CAAEA,CAAA,GAAMhC,gBAAgB,CAAC,MAAM,CAAG;AAAA,CAAAI,QAAA,CAC1C,MAED,CAAQ,CAAC,cACT/H,IAAA,CAACR,MAAM,EACL8J,IAAI,CAAC,IAAI,CACTE,WAAW,CAAC,MAAM,CAClBC,OAAO,CAAEhH,IAAI,GAAK,MAAM,CAAG,OAAO,CAAG,SAAU,CAC/CiH,OAAO,CAAEjH,IAAI,GAAK,MAAM,CAAG,CAAC,CAAG,GAAI,CACnCkH,OAAO,CAAEA,CAAA,GAAMjH,OAAO,CAAC,MAAM,CAAE,CAAAqF,QAAA,CAChC,MAED,CAAQ,CAAC,cACT/H,IAAA,CAACR,MAAM,EACL8J,IAAI,CAAC,IAAI,CACTE,WAAW,CAAC,QAAQ,CACpBG,OAAO,CAAEA,CAAA,GAAM,CACb;AACA3G,mBAAmB,CAAC,IAAI,CAAC,CACzBwC,UAAU,CAAC,IAAMxC,mBAAmB,CAAC,KAAK,CAAC,CAAE,IAAI,CAAC,CAElDpE,SAAS,CAAC8F,iBAAiB,CAAC,CAC1BjC,IAAI,CAAEA,IAAI,CACVkC,MAAM,CAAElD,UAAU,CAACE,GAAG,CAAEyC,IAAI,GAAM,CAChCrC,IAAI,CAAE,CAACqC,IAAI,CAACtC,CAAC,CAAEsC,IAAI,CAACpC,CAAC,CAAEoC,IAAI,CAACnC,KAAK,CAAEmC,IAAI,CAAClC,MAAM,CAAC,CAC/CC,KAAK,CAAEiC,IAAI,CAACjC,KACd,CAAC,CAAC,CAAC,CACHU,KAAK,CAAEA,KAAK,CACZ+B,cAAc,CAAE,IAClB,CAAC,CAAC,CACJ,CAAE,CAAAmD,QAAA,CACH,MAED,CAAQ,CAAC,EACH,CAAC,EACL,CAAC,cAEP/H,IAAA,CAACN,IAAI,EAACkK,EAAE,CAAE,CAAE,CAACd,cAAc,CAAC,eAAe,CAACD,UAAU,CAAC,QAAQ,CAAAd,QAAA,cAC7D7H,KAAA,CAACT,IAAI,EAACyJ,QAAQ,CAAC,IAAI,CAACd,KAAK,CAAEZ,SAAU,CAAAO,QAAA,EAAC,kBAAgB,CAACtG,UAAU,CAACgC,MAAM,EAAO,CAAC,CAC5E,CAAC,EACJ,CAAC,cAGNzD,IAAA,CAACZ,GAAG,EAAA2I,QAAA,cACF/H,IAAA,CAACT,MAAM,EAAAwI,QAAA,cACP/H,IAAA,CAACH,UAAU,EACT4B,UAAU,CAAEA,UAAW,CACvBgB,IAAI,CAAEA,IAAK,CACXH,UAAU,CAAEA,UAAW,CACvBO,KAAK,CAAEA,KAAM,CACbN,aAAa,CAAEA,aAAc,CAC7Bb,aAAa,CAAEA,aAAc,CAC7Bc,QAAQ,CAAEA,QAAS,CACnB3B,SAAS,CAAEA,SAAU,CACrBsB,KAAK,CAAEA,KAAM,CACbX,KAAK,CAAEA,KAAM,CACbb,UAAU,CAAEA,UAAW,CACvBkJ,WAAW,CAAE/I,UAAW,CACxB6B,eAAe,CAAEA,eAAgB,CACjCC,kBAAkB,CAAEA,kBAAmB,CACvCgD,sBAAsB,CAAEA,sBAAuB,CAC/C3C,UAAU,CAAEA,UAAW,CACvBE,eAAe,CAAEA,eAAiB;AAAA,CAClCI,eAAe,CAAEA,eAAiB;AAAA,CAClCC,kBAAkB,CAAEA,kBAAmB,CACvCqE,sBAAsB,CAAEA,sBAAuB,CAC/CxE,eAAe,CAAEA,eAAgB,CAClC,CAAC,CACM,CAAC,CACN,CAAC,EACA,CAAC,CACK,CAAC,CAErB,CAAC,CAED,cAAe,CAAAxE,uBAAuB,CAAC0B,SAAS,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}